<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NWC Point of Sale: NWC Namespace Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">NWC Point of Sale<span id="projectnumber">&#160;v1.0.0</span>
   </div>
   <div id="projectbrief">Nostr Wallet Connect Point of Sale device for ESP32 with Lightning Network payments</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('namespace_n_w_c.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#namespaces">Namespaces</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">NWC Namespace Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="namespaces" name="namespaces"></a>
Namespaces</h2></td></tr>
<tr class="memitem:namespace_n_w_c_1_1_config"><td class="memItemLeft" align="right" valign="top">namespace &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_n_w_c_1_1_config.html">Config</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:namespace_n_w_c_1_1_currency"><td class="memItemLeft" align="right" valign="top">namespace &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_n_w_c_1_1_currency.html">Currency</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="typedef-members" name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:a331436fb2caeba54627e342126185a74"><td class="memItemLeft" align="right" valign="top">typedef void(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_n_w_c.html#a331436fb2caeba54627e342126185a74">nwc_status_callback_t</a>) (bool connected, const String &amp;status)</td></tr>
<tr class="separator:a331436fb2caeba54627e342126185a74"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a1c1d9172198a60da5d26688610968af8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_n_w_c.html#a1c1d9172198a60da5d26688610968af8">init</a> ()</td></tr>
<tr class="separator:a1c1d9172198a60da5d26688610968af8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a441487b7105f0c9cc662578d3600a034"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_n_w_c.html#a441487b7105f0c9cc662578d3600a034">cleanup</a> ()</td></tr>
<tr class="separator:a441487b7105f0c9cc662578d3600a034"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a99fdb7cc9f77370099522b3461ad84ab"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_n_w_c.html#a99fdb7cc9f77370099522b3461ad84ab">setupData</a> (const String &amp;url)</td></tr>
<tr class="separator:a99fdb7cc9f77370099522b3461ad84ab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a72c06bdc692eac76bc21d4e73ce31349"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_n_w_c.html#a72c06bdc692eac76bc21d4e73ce31349">connectToRelay</a> ()</td></tr>
<tr class="separator:a72c06bdc692eac76bc21d4e73ce31349"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a342261f4ab3c85e7f89e8664b3311bf4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_n_w_c.html#a342261f4ab3c85e7f89e8664b3311bf4">restartConnection</a> ()</td></tr>
<tr class="separator:a342261f4ab3c85e7f89e8664b3311bf4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a88a8c82c8be5fc4c9ef6fa6f35b8a581"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_n_w_c.html#a88a8c82c8be5fc4c9ef6fa6f35b8a581">disconnect</a> ()</td></tr>
<tr class="separator:a88a8c82c8be5fc4c9ef6fa6f35b8a581"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a15d4ed6dee9570b25a02a7fe34b9ece0"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_n_w_c.html#a15d4ed6dee9570b25a02a7fe34b9ece0">isInitialized</a> ()</td></tr>
<tr class="separator:a15d4ed6dee9570b25a02a7fe34b9ece0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa2e749abffc8f1f4995bb52e3a6e8f47"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_n_w_c.html#aa2e749abffc8f1f4995bb52e3a6e8f47">isConnected</a> ()</td></tr>
<tr class="separator:aa2e749abffc8f1f4995bb52e3a6e8f47"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a12351ef57b22b79c192426979a938cc3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_n_w_c.html#a12351ef57b22b79c192426979a938cc3">loadUrlFromPreferences</a> ()</td></tr>
<tr class="separator:a12351ef57b22b79c192426979a938cc3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a14fff083f2b310dfa50fad5e75510d22"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_n_w_c.html#a14fff083f2b310dfa50fad5e75510d22">saveUrlToPreferences</a> (const String &amp;url)</td></tr>
<tr class="separator:a14fff083f2b310dfa50fad5e75510d22"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae645013edf0be68e8ea57f7130b136e4"><td class="memItemLeft" align="right" valign="top">String&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_n_w_c.html#ae645013edf0be68e8ea57f7130b136e4">getPairingUrl</a> ()</td></tr>
<tr class="separator:ae645013edf0be68e8ea57f7130b136e4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a66b3bd6f1962777af5011df44dcf85e7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_n_w_c.html#a66b3bd6f1962777af5011df44dcf85e7">setPairingUrl</a> (const String &amp;url)</td></tr>
<tr class="separator:a66b3bd6f1962777af5011df44dcf85e7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa137fc6f2c6092d4b9464c4246e851c6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_n_w_c.html#aa137fc6f2c6092d4b9464c4246e851c6">websocketEvent</a> (WStype_t type, uint8_t *payload, size_t length)</td></tr>
<tr class="separator:aa137fc6f2c6092d4b9464c4246e851c6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a18f2ad2c95003389637ea9d84d18d5cf"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_n_w_c.html#a18f2ad2c95003389637ea9d84d18d5cf">handleWebsocketMessage</a> (void *arg, uint8_t *data, size_t len)</td></tr>
<tr class="separator:a18f2ad2c95003389637ea9d84d18d5cf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a870035d4e450773ec8a50d0bf0b81702"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_n_w_c.html#a870035d4e450773ec8a50d0bf0b81702">resetWebsocketFragmentState</a> ()</td></tr>
<tr class="separator:a870035d4e450773ec8a50d0bf0b81702"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2ea8f4d93d51274c1ed01f85eadeb3c1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_n_w_c.html#a2ea8f4d93d51274c1ed01f85eadeb3c1">handleNwcResponseEvent</a> (uint8_t *data)</td></tr>
<tr class="separator:a2ea8f4d93d51274c1ed01f85eadeb3c1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a964d9daf0d78f7807e9dffc07d0b00df"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_n_w_c.html#a964d9daf0d78f7807e9dffc07d0b00df">handleNwcNip04NotificationEvent</a> (uint8_t *data)</td></tr>
<tr class="separator:a964d9daf0d78f7807e9dffc07d0b00df"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a226efbf68836ffd12773687ebece1f06"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_n_w_c.html#a226efbf68836ffd12773687ebece1f06">handleNwcNip44NotificationEvent</a> (uint8_t *data)</td></tr>
<tr class="separator:a226efbf68836ffd12773687ebece1f06"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5d747ef50eeb74cee5612fd939452183"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_n_w_c.html#a5d747ef50eeb74cee5612fd939452183">makeInvoice</a> (float amount, const String &amp;currency)</td></tr>
<tr class="separator:a5d747ef50eeb74cee5612fd939452183"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a86b3f2617b12ae02c2e60ea915a43076"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_n_w_c.html#a86b3f2617b12ae02c2e60ea915a43076">sendInvoiceLookupRequest</a> ()</td></tr>
<tr class="separator:a86b3f2617b12ae02c2e60ea915a43076"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a209d5a499b7718c1a0d5984a191091a9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_n_w_c.html#a209d5a499b7718c1a0d5984a191091a9">startInvoiceNotificationWatchdog</a> ()</td></tr>
<tr class="separator:a209d5a499b7718c1a0d5984a191091a9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9a72ecf2c1ad80aafcb1d1a79651d0aa"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_n_w_c.html#a9a72ecf2c1ad80aafcb1d1a79651d0aa">stopInvoiceNotificationWatchdog</a> ()</td></tr>
<tr class="separator:a9a72ecf2c1ad80aafcb1d1a79651d0aa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1c4b50b7a22b309f6b6f3ddcf9f32a74"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_n_w_c.html#a1c4b50b7a22b309f6b6f3ddcf9f32a74">startInvoiceLookupTimer</a> ()</td></tr>
<tr class="separator:a1c4b50b7a22b309f6b6f3ddcf9f32a74"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1dd636b9104cd24b5d2fbd91329a67cd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_n_w_c.html#a1dd636b9104cd24b5d2fbd91329a67cd">stopInvoiceLookupTimer</a> ()</td></tr>
<tr class="separator:a1dd636b9104cd24b5d2fbd91329a67cd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac8bb8a5bfcd2f30e2e35458ceeac24cd"><td class="memItemLeft" align="right" valign="top">String&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_n_w_c.html#ac8bb8a5bfcd2f30e2e35458ceeac24cd">getCurrentInvoice</a> ()</td></tr>
<tr class="separator:ac8bb8a5bfcd2f30e2e35458ceeac24cd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4e5666c5f59ca4d455e2148a3f06d329"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_n_w_c.html#a4e5666c5f59ca4d455e2148a3f06d329">setCurrentInvoice</a> (const String &amp;invoice)</td></tr>
<tr class="separator:a4e5666c5f59ca4d455e2148a3f06d329"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aef169814af2af3b5a32f4f0c30456385"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_n_w_c.html#aef169814af2af3b5a32f4f0c30456385">fetchBitcoinPrices</a> ()</td></tr>
<tr class="separator:aef169814af2af3b5a32f4f0c30456385"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6084bca944be2b2f16e57728dbbc64dc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_n_w_c.html#a6084bca944be2b2f16e57728dbbc64dc">updatePricesFromJson</a> (const String &amp;jsonResponse)</td></tr>
<tr class="separator:a6084bca944be2b2f16e57728dbbc64dc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adf733f5382e816e1e45d39bf3e3ec04f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_n_w_c.html#adf733f5382e816e1e45d39bf3e3ec04f">calculateSatsFromAmount</a> (float amount, const String &amp;currency)</td></tr>
<tr class="separator:adf733f5382e816e1e45d39bf3e3ec04f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2d1e53d84c677b6b30da4a0b845352d1"><td class="memItemLeft" align="right" valign="top">long *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_n_w_c.html#a2d1e53d84c677b6b30da4a0b845352d1">getBitcoinPrices</a> ()</td></tr>
<tr class="separator:a2d1e53d84c677b6b30da4a0b845352d1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a26bfd6ee56d21e22fc6caa559711c011"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_n_w_c.html#a26bfd6ee56d21e22fc6caa559711c011">arePricesLoaded</a> ()</td></tr>
<tr class="separator:a26bfd6ee56d21e22fc6caa559711c011"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeaebbdb90bbebb939c1149ad621e9455"><td class="memItemLeft" align="right" valign="top">unsigned long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_n_w_c.html#aeaebbdb90bbebb939c1149ad621e9455">getLastPriceUpdate</a> ()</td></tr>
<tr class="separator:aeaebbdb90bbebb939c1149ad621e9455"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acaa1e327e2f86e4e3101cc552c8ed24c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_n_w_c.html#acaa1e327e2f86e4e3101cc552c8ed24c">attemptReconnectionIfNeeded</a> ()</td></tr>
<tr class="separator:acaa1e327e2f86e4e3101cc552c8ed24c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a28e8eb156bed73d6466b37fe3d81241d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_n_w_c.html#a28e8eb156bed73d6466b37fe3d81241d">updateRelayStatusDisplay</a> (bool connected)</td></tr>
<tr class="separator:a28e8eb156bed73d6466b37fe3d81241d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acd1483629fef32437ab3d58cbfe11318"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_n_w_c.html#acd1483629fef32437ab3d58cbfe11318">updateTime</a> ()</td></tr>
<tr class="separator:acd1483629fef32437ab3d58cbfe11318"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a08f91f132a611875988ba75c6d196318"><td class="memItemLeft" align="right" valign="top">unsigned long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_n_w_c.html#a08f91f132a611875988ba75c6d196318">getUnixTimestamp</a> ()</td></tr>
<tr class="separator:a08f91f132a611875988ba75c6d196318"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a75a93db0e7805efd74eb67c4c458a66f"><td class="memItemLeft" align="right" valign="top">unsigned long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_n_w_c.html#a75a93db0e7805efd74eb67c4c458a66f">getBootTimestamp</a> ()</td></tr>
<tr class="separator:a75a93db0e7805efd74eb67c4c458a66f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8ef3c6df0ec5f0c7cbec9ee9a180db8f"><td class="memItemLeft" align="right" valign="top">NTPClient &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_n_w_c.html#a8ef3c6df0ec5f0c7cbec9ee9a180db8f">getTimeClient</a> ()</td></tr>
<tr class="separator:a8ef3c6df0ec5f0c7cbec9ee9a180db8f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af6a6e3b53f844f01887bfa71344c836f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_n_w_c.html#af6a6e3b53f844f01887bfa71344c836f">sendPing</a> ()</td></tr>
<tr class="separator:af6a6e3b53f844f01887bfa71344c836f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a10d04b654063bcec6d1bcf528fb3a24d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_n_w_c.html#a10d04b654063bcec6d1bcf528fb3a24d">processLoop</a> ()</td></tr>
<tr class="separator:a10d04b654063bcec6d1bcf528fb3a24d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acbeaaf60838294051dacb43171560fbf"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_n_w_c.html#acbeaaf60838294051dacb43171560fbf">isFragmentInProgress</a> ()</td></tr>
<tr class="separator:acbeaaf60838294051dacb43171560fbf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a952c9d2aa4e8bedd3484fd68feefab9b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_n_w_c.html#a952c9d2aa4e8bedd3484fd68feefab9b">handleFragment</a> (uint8_t *payload, size_t length, bool isBinary, bool isLast)</td></tr>
<tr class="separator:a952c9d2aa4e8bedd3484fd68feefab9b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8a33716d68e6fc7b598f13474a8aa3d0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_n_w_c.html#a8a33716d68e6fc7b598f13474a8aa3d0">invoiceLookupTimerCallback</a> (lv_timer_t *timer)</td></tr>
<tr class="separator:a8a33716d68e6fc7b598f13474a8aa3d0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8f8ca7e2372b1dce642bba4ad410d190"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_n_w_c.html#a8f8ca7e2372b1dce642bba4ad410d190">invoiceNotificationWatchdogCallback</a> (lv_timer_t *timer)</td></tr>
<tr class="separator:a8f8ca7e2372b1dce642bba4ad410d190"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa67b7139a1355f5f43c75c014796dd80"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_n_w_c.html#aa67b7139a1355f5f43c75c014796dd80">setStatusCallback</a> (<a class="el" href="namespace_n_w_c.html#a331436fb2caeba54627e342126185a74">nwc_status_callback_t</a> callback)</td></tr>
<tr class="separator:aa67b7139a1355f5f43c75c014796dd80"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac164a3889940ecbe838a8d52cd0dd2f7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_n_w_c.html#ac164a3889940ecbe838a8d52cd0dd2f7">setRelayStatusLabel</a> (lv_obj_t *label)</td></tr>
<tr class="separator:ac164a3889940ecbe838a8d52cd0dd2f7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aee89013cd6a45b02d0f848879e96da16"><td class="memItemLeft" align="right" valign="top">WebSocketsClient &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_n_w_c.html#aee89013cd6a45b02d0f848879e96da16">getWebSocketClient</a> ()</td></tr>
<tr class="separator:aee89013cd6a45b02d0f848879e96da16"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abb2a09968c5b268eef33006b22a32c12"><td class="memItemLeft" align="right" valign="top">String&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_n_w_c.html#abb2a09968c5b268eef33006b22a32c12">getRelayUrl</a> ()</td></tr>
<tr class="separator:abb2a09968c5b268eef33006b22a32c12"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8b64dfdf4a3cc775ec132ba31825a340"><td class="memItemLeft" align="right" valign="top">String&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_n_w_c.html#a8b64dfdf4a3cc775ec132ba31825a340">getWalletPubKey</a> ()</td></tr>
<tr class="separator:a8b64dfdf4a3cc775ec132ba31825a340"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8819a0f510ab7fcb3dc3381db3a0eab6"><td class="memItemLeft" align="right" valign="top">String&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_n_w_c.html#a8819a0f510ab7fcb3dc3381db3a0eab6">getNsecHex</a> ()</td></tr>
<tr class="separator:a8819a0f510ab7fcb3dc3381db3a0eab6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a21272097203f647bcfc29821d1035eb8"><td class="memItemLeft" align="right" valign="top">String&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_n_w_c.html#a21272097203f647bcfc29821d1035eb8">getNpubHex</a> ()</td></tr>
<tr class="separator:a21272097203f647bcfc29821d1035eb8"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Typedef Documentation</h2>
<a id="a331436fb2caeba54627e342126185a74" name="a331436fb2caeba54627e342126185a74"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a331436fb2caeba54627e342126185a74">&#9670;&#160;</a></span>nwc_status_callback_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef void(* NWC::nwc_status_callback_t) (bool connected, const String &amp;status)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nwc_8h_source.html#l00083">83</a> of file <a class="el" href="nwc_8h_source.html">nwc.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a26bfd6ee56d21e22fc6caa559711c011" name="a26bfd6ee56d21e22fc6caa559711c011"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a26bfd6ee56d21e22fc6caa559711c011">&#9670;&#160;</a></span>arePricesLoaded()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool NWC::arePricesLoaded </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nwc_8cpp_source.html#l00739">739</a> of file <a class="el" href="nwc_8cpp_source.html">nwc.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  739</span>                           {</div>
<div class="line"><span class="lineno">  740</span>        <span class="keywordflow">return</span> prices_loaded;</div>
<div class="line"><span class="lineno">  741</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="acaa1e327e2f86e4e3101cc552c8ed24c" name="acaa1e327e2f86e4e3101cc552c8ed24c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acaa1e327e2f86e4e3101cc552c8ed24c">&#9670;&#160;</a></span>attemptReconnectionIfNeeded()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NWC::attemptReconnectionIfNeeded </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nwc_8cpp_source.html#l00747">747</a> of file <a class="el" href="nwc_8cpp_source.html">nwc.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  747</span>                                       {</div>
<div class="line"><span class="lineno">  748</span>        <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> current_time = millis();</div>
<div class="line"><span class="lineno">  749</span>        </div>
<div class="line"><span class="lineno">  750</span>        <span class="comment">// Only proceed if WiFi is connected</span></div>
<div class="line"><span class="lineno">  751</span>        <span class="keywordflow">if</span> (WiFi.status() != WL_CONNECTED) {</div>
<div class="line"><span class="lineno">  752</span>            <span class="keywordflow">if</span> (<a class="code hl_function" href="namespace_n_w_c.html#aa2e749abffc8f1f4995bb52e3a6e8f47">isConnected</a>() || <a class="code hl_variable" href="ui_8cpp.html#a948b1584cfc5c1cf91af9d43729abf48">nwc_initialized</a>) {</div>
<div class="line"><span class="lineno">  753</span>                Serial.println(<span class="stringliteral">&quot;WiFi disconnected, resetting NWC connection state&quot;</span>);</div>
<div class="line"><span class="lineno">  754</span>                <a class="code hl_variable" href="ui_8cpp.html#a948b1584cfc5c1cf91af9d43729abf48">nwc_initialized</a> = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  755</span>                <a class="code hl_function" href="namespace_n_w_c.html#a28e8eb156bed73d6466b37fe3d81241d">updateRelayStatusDisplay</a>(<span class="keyword">false</span>);</div>
<div class="line"><span class="lineno">  756</span>            }</div>
<div class="line"><span class="lineno">  757</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  758</span>        }</div>
<div class="line"><span class="lineno">  759</span>        </div>
<div class="line"><span class="lineno">  760</span>        <span class="comment">// Check connection health periodically</span></div>
<div class="line"><span class="lineno">  761</span>        <span class="keywordflow">if</span> (current_time - last_connection_health_check &gt;= HEALTH_CHECK_INTERVAL) {</div>
<div class="line"><span class="lineno">  762</span>            last_connection_health_check = current_time;</div>
<div class="line"><span class="lineno">  763</span>            </div>
<div class="line"><span class="lineno">  764</span>            <span class="comment">// If we think we&#39;re connected but haven&#39;t received any messages for too long, force reconnect</span></div>
<div class="line"><span class="lineno">  765</span>            <span class="keywordflow">if</span> (<a class="code hl_function" href="namespace_n_w_c.html#aa2e749abffc8f1f4995bb52e3a6e8f47">isConnected</a>() &amp;&amp; <a class="code hl_variable" href="ui_8cpp.html#a948b1584cfc5c1cf91af9d43729abf48">nwc_initialized</a>) {</div>
<div class="line"><span class="lineno">  766</span>                <span class="keywordflow">if</span> (current_time - last_ws_message_received &gt; CONNECTION_TIMEOUT) {</div>
<div class="line"><span class="lineno">  767</span>                    Serial.println(<span class="stringliteral">&quot;Connection appears stale (no messages for &quot;</span> + String(CONNECTION_TIMEOUT/1000) + <span class="stringliteral">&quot;s), forcing disconnect&quot;</span>);</div>
<div class="line"><span class="lineno">  768</span>                    webSocket.disconnect();</div>
<div class="line"><span class="lineno">  769</span>                    <a class="code hl_variable" href="ui_8cpp.html#a948b1584cfc5c1cf91af9d43729abf48">nwc_initialized</a> = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  770</span>                    <a class="code hl_function" href="namespace_n_w_c.html#a28e8eb156bed73d6466b37fe3d81241d">updateRelayStatusDisplay</a>(<span class="keyword">false</span>);</div>
<div class="line"><span class="lineno">  771</span>                    <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  772</span>                }</div>
<div class="line"><span class="lineno">  773</span>                </div>
<div class="line"><span class="lineno">  774</span>                <span class="comment">// Send periodic ping to keep connection alive</span></div>
<div class="line"><span class="lineno">  775</span>                <span class="keywordflow">if</span> (current_time - last_ws_ping &gt; PING_INTERVAL) {</div>
<div class="line"><span class="lineno">  776</span>                    <a class="code hl_function" href="namespace_n_w_c.html#af6a6e3b53f844f01887bfa71344c836f">sendPing</a>();</div>
<div class="line"><span class="lineno">  777</span>                }</div>
<div class="line"><span class="lineno">  778</span>            }</div>
<div class="line"><span class="lineno">  779</span>        }</div>
<div class="line"><span class="lineno">  780</span>        </div>
<div class="line"><span class="lineno">  781</span>        <span class="comment">// Attempt reconnection if not connected and not already trying</span></div>
<div class="line"><span class="lineno">  782</span>        <span class="keywordflow">if</span> (!<a class="code hl_function" href="namespace_n_w_c.html#aa2e749abffc8f1f4995bb52e3a6e8f47">isConnected</a>() &amp;&amp; !connection_in_progress) {</div>
<div class="line"><span class="lineno">  783</span>            <span class="comment">// Calculate backoff interval based on number of attempts</span></div>
<div class="line"><span class="lineno">  784</span>            <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> backoff_interval = MIN_RECONNECT_INTERVAL * (1 &lt;&lt; min(reconnection_attempts, 5)); <span class="comment">// Exponential backoff, max 32x</span></div>
<div class="line"><span class="lineno">  785</span>            </div>
<div class="line"><span class="lineno">  786</span>            <span class="keywordflow">if</span> (current_time - last_connection_attempt &gt;= backoff_interval) {</div>
<div class="line"><span class="lineno">  787</span>                <span class="keywordflow">if</span> (reconnection_attempts &lt; MAX_RECONNECT_ATTEMPTS) {</div>
<div class="line"><span class="lineno">  788</span>                    Serial.println(<span class="stringliteral">&quot;Attempting WebSocket reconnection (attempt &quot;</span> + String(reconnection_attempts + 1) + <span class="stringliteral">&quot;/&quot;</span> + String(MAX_RECONNECT_ATTEMPTS) + <span class="stringliteral">&quot;)&quot;</span>);</div>
<div class="line"><span class="lineno">  789</span>                    reconnection_attempts++;</div>
<div class="line"><span class="lineno">  790</span>                    <a class="code hl_function" href="namespace_n_w_c.html#a72c06bdc692eac76bc21d4e73ce31349">connectToRelay</a>();</div>
<div class="line"><span class="lineno">  791</span>                } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  792</span>                    <span class="comment">// Reset reconnection attempts after max attempts reached, but wait longer</span></div>
<div class="line"><span class="lineno">  793</span>                    <span class="keywordflow">if</span> (current_time - last_connection_attempt &gt;= (backoff_interval * 4)) {</div>
<div class="line"><span class="lineno">  794</span>                        Serial.println(<span class="stringliteral">&quot;Resetting reconnection attempts after extended wait&quot;</span>);</div>
<div class="line"><span class="lineno">  795</span>                        reconnection_attempts = 0;</div>
<div class="line"><span class="lineno">  796</span>                    }</div>
<div class="line"><span class="lineno">  797</span>                }</div>
<div class="line"><span class="lineno">  798</span>            }</div>
<div class="line"><span class="lineno">  799</span>        }</div>
<div class="line"><span class="lineno">  800</span>    }</div>
<div class="ttc" id="anamespace_n_w_c_html_a28e8eb156bed73d6466b37fe3d81241d"><div class="ttname"><a href="namespace_n_w_c.html#a28e8eb156bed73d6466b37fe3d81241d">NWC::updateRelayStatusDisplay</a></div><div class="ttdeci">void updateRelayStatusDisplay(bool connected)</div><div class="ttdef"><b>Definition:</b> <a href="nwc_8cpp_source.html#l00802">nwc.cpp:802</a></div></div>
<div class="ttc" id="anamespace_n_w_c_html_a72c06bdc692eac76bc21d4e73ce31349"><div class="ttname"><a href="namespace_n_w_c.html#a72c06bdc692eac76bc21d4e73ce31349">NWC::connectToRelay</a></div><div class="ttdeci">void connectToRelay()</div><div class="ttdef"><b>Definition:</b> <a href="nwc_8cpp_source.html#l00167">nwc.cpp:167</a></div></div>
<div class="ttc" id="anamespace_n_w_c_html_aa2e749abffc8f1f4995bb52e3a6e8f47"><div class="ttname"><a href="namespace_n_w_c.html#aa2e749abffc8f1f4995bb52e3a6e8f47">NWC::isConnected</a></div><div class="ttdeci">bool isConnected()</div><div class="ttdef"><b>Definition:</b> <a href="nwc_8cpp_source.html#l00256">nwc.cpp:256</a></div></div>
<div class="ttc" id="anamespace_n_w_c_html_af6a6e3b53f844f01887bfa71344c836f"><div class="ttname"><a href="namespace_n_w_c.html#af6a6e3b53f844f01887bfa71344c836f">NWC::sendPing</a></div><div class="ttdeci">void sendPing()</div><div class="ttdef"><b>Definition:</b> <a href="nwc_8cpp_source.html#l00842">nwc.cpp:842</a></div></div>
<div class="ttc" id="aui_8cpp_html_a948b1584cfc5c1cf91af9d43729abf48"><div class="ttname"><a href="ui_8cpp.html#a948b1584cfc5c1cf91af9d43729abf48">nwc_initialized</a></div><div class="ttdeci">bool nwc_initialized</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="adf733f5382e816e1e45d39bf3e3ec04f" name="adf733f5382e816e1e45d39bf3e3ec04f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adf733f5382e816e1e45d39bf3e3ec04f">&#9670;&#160;</a></span>calculateSatsFromAmount()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int NWC::calculateSatsFromAmount </td>
          <td>(</td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>amount</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const String &amp;&#160;</td>
          <td class="paramname"><em>currency</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nwc_8cpp_source.html#l00713">713</a> of file <a class="el" href="nwc_8cpp_source.html">nwc.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  713</span>                                                                      {</div>
<div class="line"><span class="lineno">  714</span>        <span class="keywordflow">if</span> (!prices_loaded) {</div>
<div class="line"><span class="lineno">  715</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  716</span>        }</div>
<div class="line"><span class="lineno">  717</span>        </div>
<div class="line"><span class="lineno">  718</span>        <span class="keywordtype">long</span> price = 0;</div>
<div class="line"><span class="lineno">  719</span>        <span class="keywordflow">if</span> (currency == <span class="stringliteral">&quot;USD&quot;</span>) price = btc_prices[Currency::USD];</div>
<div class="line"><span class="lineno">  720</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (currency == <span class="stringliteral">&quot;EUR&quot;</span>) price = btc_prices[Currency::EUR];</div>
<div class="line"><span class="lineno">  721</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (currency == <span class="stringliteral">&quot;GBP&quot;</span>) price = btc_prices[Currency::GBP];</div>
<div class="line"><span class="lineno">  722</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (currency == <span class="stringliteral">&quot;CAD&quot;</span>) price = btc_prices[Currency::CAD];</div>
<div class="line"><span class="lineno">  723</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (currency == <span class="stringliteral">&quot;CHF&quot;</span>) price = btc_prices[Currency::CHF];</div>
<div class="line"><span class="lineno">  724</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (currency == <span class="stringliteral">&quot;AUD&quot;</span>) price = btc_prices[Currency::AUD];</div>
<div class="line"><span class="lineno">  725</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (currency == <span class="stringliteral">&quot;JPY&quot;</span>) price = btc_prices[Currency::JPY];</div>
<div class="line"><span class="lineno">  726</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (currency == <span class="stringliteral">&quot;CNY&quot;</span>) price = btc_prices[Currency::CNY];</div>
<div class="line"><span class="lineno">  727</span>        </div>
<div class="line"><span class="lineno">  728</span>        <span class="keywordflow">if</span> (price &gt; 0) {</div>
<div class="line"><span class="lineno">  729</span>            <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)((amount / price) * 100000000); <span class="comment">// Convert to satoshis</span></div>
<div class="line"><span class="lineno">  730</span>        }</div>
<div class="line"><span class="lineno">  731</span>        </div>
<div class="line"><span class="lineno">  732</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  733</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a441487b7105f0c9cc662578d3600a034" name="a441487b7105f0c9cc662578d3600a034"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a441487b7105f0c9cc662578d3600a034">&#9670;&#160;</a></span>cleanup()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NWC::cleanup </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nwc_8cpp_source.html#l00090">90</a> of file <a class="el" href="nwc_8cpp_source.html">nwc.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   90</span>                   {</div>
<div class="line"><span class="lineno">   91</span>        <span class="keywordflow">if</span> (invoice_notification_watchdog_timer) {</div>
<div class="line"><span class="lineno">   92</span>            lv_timer_del(invoice_notification_watchdog_timer);</div>
<div class="line"><span class="lineno">   93</span>            invoice_notification_watchdog_timer = NULL;</div>
<div class="line"><span class="lineno">   94</span>        }</div>
<div class="line"><span class="lineno">   95</span>        </div>
<div class="line"><span class="lineno">   96</span>        <span class="keywordflow">if</span> (invoice_lookup_timer) {</div>
<div class="line"><span class="lineno">   97</span>            lv_timer_del(invoice_lookup_timer);</div>
<div class="line"><span class="lineno">   98</span>            invoice_lookup_timer = NULL;</div>
<div class="line"><span class="lineno">   99</span>        }</div>
<div class="line"><span class="lineno">  100</span>        </div>
<div class="line"><span class="lineno">  101</span>        webSocket.disconnect();</div>
<div class="line"><span class="lineno">  102</span>        <a class="code hl_variable" href="ui_8cpp.html#a948b1584cfc5c1cf91af9d43729abf48">nwc_initialized</a> = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  103</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a72c06bdc692eac76bc21d4e73ce31349" name="a72c06bdc692eac76bc21d4e73ce31349"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a72c06bdc692eac76bc21d4e73ce31349">&#9670;&#160;</a></span>connectToRelay()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NWC::connectToRelay </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nwc_8cpp_source.html#l00167">167</a> of file <a class="el" href="nwc_8cpp_source.html">nwc.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  167</span>                          {</div>
<div class="line"><span class="lineno">  168</span>        <span class="keywordflow">if</span> (relayUrl.length() == 0) {</div>
<div class="line"><span class="lineno">  169</span>            Serial.println(<span class="stringliteral">&quot;No relay URL configured&quot;</span>);</div>
<div class="line"><span class="lineno">  170</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  171</span>        }</div>
<div class="line"><span class="lineno">  172</span>        </div>
<div class="line"><span class="lineno">  173</span>        <span class="comment">// Prevent multiple simultaneous connection attempts</span></div>
<div class="line"><span class="lineno">  174</span>        <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> current_time = millis();</div>
<div class="line"><span class="lineno">  175</span>        <span class="keywordflow">if</span> (connection_in_progress) {</div>
<div class="line"><span class="lineno">  176</span>            Serial.println(<span class="stringliteral">&quot;Connection already in progress, skipping&quot;</span>);</div>
<div class="line"><span class="lineno">  177</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  178</span>        }</div>
<div class="line"><span class="lineno">  179</span>        </div>
<div class="line"><span class="lineno">  180</span>        <span class="comment">// Rate limit connection attempts</span></div>
<div class="line"><span class="lineno">  181</span>        <span class="keywordflow">if</span> (current_time - last_connection_attempt &lt; MIN_RECONNECT_INTERVAL) {</div>
<div class="line"><span class="lineno">  182</span>            Serial.println(<span class="stringliteral">&quot;Too soon to reconnect, waiting...&quot;</span>);</div>
<div class="line"><span class="lineno">  183</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  184</span>        }</div>
<div class="line"><span class="lineno">  185</span>        </div>
<div class="line"><span class="lineno">  186</span>        <span class="comment">// Check if already connected</span></div>
<div class="line"><span class="lineno">  187</span>        <span class="keywordflow">if</span> (webSocket.isConnected()) {</div>
<div class="line"><span class="lineno">  188</span>            Serial.println(<span class="stringliteral">&quot;WebSocket already connected&quot;</span>);</div>
<div class="line"><span class="lineno">  189</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  190</span>        }</div>
<div class="line"><span class="lineno">  191</span>        </div>
<div class="line"><span class="lineno">  192</span>        connection_in_progress = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  193</span>        last_connection_attempt = current_time;</div>
<div class="line"><span class="lineno">  194</span>        </div>
<div class="line"><span class="lineno">  195</span>        <span class="comment">// Parse relay URL</span></div>
<div class="line"><span class="lineno">  196</span>        String host;</div>
<div class="line"><span class="lineno">  197</span>        <span class="keywordtype">int</span> port = 443; <span class="comment">// Default WSS port</span></div>
<div class="line"><span class="lineno">  198</span>        String path = <span class="stringliteral">&quot;/&quot;</span>;</div>
<div class="line"><span class="lineno">  199</span>        </div>
<div class="line"><span class="lineno">  200</span>        <span class="keywordflow">if</span> (relayUrl.startsWith(<span class="stringliteral">&quot;wss://&quot;</span>)) {</div>
<div class="line"><span class="lineno">  201</span>            host = relayUrl.substring(6);</div>
<div class="line"><span class="lineno">  202</span>            <span class="keywordtype">int</span> pathIndex = host.indexOf(<span class="charliteral">&#39;/&#39;</span>);</div>
<div class="line"><span class="lineno">  203</span>            <span class="keywordflow">if</span> (pathIndex != -1) {</div>
<div class="line"><span class="lineno">  204</span>                path = host.substring(pathIndex);</div>
<div class="line"><span class="lineno">  205</span>                host = host.substring(0, pathIndex);</div>
<div class="line"><span class="lineno">  206</span>            }</div>
<div class="line"><span class="lineno">  207</span>            </div>
<div class="line"><span class="lineno">  208</span>            <span class="keywordtype">int</span> portIndex = host.indexOf(<span class="charliteral">&#39;:&#39;</span>);</div>
<div class="line"><span class="lineno">  209</span>            <span class="keywordflow">if</span> (portIndex != -1) {</div>
<div class="line"><span class="lineno">  210</span>                port = host.substring(portIndex + 1).toInt();</div>
<div class="line"><span class="lineno">  211</span>                host = host.substring(0, portIndex);</div>
<div class="line"><span class="lineno">  212</span>            }</div>
<div class="line"><span class="lineno">  213</span>        }</div>
<div class="line"><span class="lineno">  214</span>        </div>
<div class="line"><span class="lineno">  215</span>        Serial.printf(<span class="stringliteral">&quot;Connecting to relay: %s:%d%s\\n&quot;</span>, host.c_str(), port, path.c_str());</div>
<div class="line"><span class="lineno">  216</span>        </div>
<div class="line"><span class="lineno">  217</span>        webSocket.beginSSL(host, port, path, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;Sec-WebSocket-Protocol: echo-protocol&quot;</span>);</div>
<div class="line"><span class="lineno">  218</span>        webSocket.onEvent([](WStype_t type, uint8_t* payload, <span class="keywordtype">size_t</span> length) {</div>
<div class="line"><span class="lineno">  219</span>            <a class="code hl_function" href="namespace_n_w_c.html#aa137fc6f2c6092d4b9464c4246e851c6">websocketEvent</a>(type, payload, length);</div>
<div class="line"><span class="lineno">  220</span>        });</div>
<div class="line"><span class="lineno">  221</span>        webSocket.setReconnectInterval(5000);</div>
<div class="line"><span class="lineno">  222</span>        webSocket.enableHeartbeat(15000, 3000, 2);</div>
<div class="line"><span class="lineno">  223</span>        </div>
<div class="line"><span class="lineno">  224</span>        <a class="code hl_variable" href="ui_8cpp.html#a948b1584cfc5c1cf91af9d43729abf48">nwc_initialized</a> = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  225</span>        </div>
<div class="line"><span class="lineno">  226</span>        Serial.println(<span class="stringliteral">&quot;WebSocket connection initiated&quot;</span>);</div>
<div class="line"><span class="lineno">  227</span>    }</div>
<div class="ttc" id="anamespace_n_w_c_html_aa137fc6f2c6092d4b9464c4246e851c6"><div class="ttname"><a href="namespace_n_w_c.html#aa137fc6f2c6092d4b9464c4246e851c6">NWC::websocketEvent</a></div><div class="ttdeci">void websocketEvent(WStype_t type, uint8_t *payload, size_t length)</div><div class="ttdef"><b>Definition:</b> <a href="nwc_8cpp_source.html#l00290">nwc.cpp:290</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a88a8c82c8be5fc4c9ef6fa6f35b8a581" name="a88a8c82c8be5fc4c9ef6fa6f35b8a581"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a88a8c82c8be5fc4c9ef6fa6f35b8a581">&#9670;&#160;</a></span>disconnect()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NWC::disconnect </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nwc_8cpp_source.html#l00241">241</a> of file <a class="el" href="nwc_8cpp_source.html">nwc.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  241</span>                      {</div>
<div class="line"><span class="lineno">  242</span>        webSocket.disconnect();</div>
<div class="line"><span class="lineno">  243</span>        <a class="code hl_variable" href="ui_8cpp.html#a948b1584cfc5c1cf91af9d43729abf48">nwc_initialized</a> = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  244</span>        connection_in_progress = <span class="keyword">false</span>;  <span class="comment">// Reset connection state</span></div>
<div class="line"><span class="lineno">  245</span>        <a class="code hl_function" href="namespace_n_w_c.html#a870035d4e450773ec8a50d0bf0b81702">resetWebsocketFragmentState</a>();</div>
<div class="line"><span class="lineno">  246</span>        </div>
<div class="line"><span class="lineno">  247</span>        <span class="keywordflow">if</span> (status_callback) {</div>
<div class="line"><span class="lineno">  248</span>            status_callback(<span class="keyword">false</span>, <span class="stringliteral">&quot;Disconnected&quot;</span>);</div>
<div class="line"><span class="lineno">  249</span>        }</div>
<div class="line"><span class="lineno">  250</span>    }</div>
<div class="ttc" id="anamespace_n_w_c_html_a870035d4e450773ec8a50d0bf0b81702"><div class="ttname"><a href="namespace_n_w_c.html#a870035d4e450773ec8a50d0bf0b81702">NWC::resetWebsocketFragmentState</a></div><div class="ttdeci">void resetWebsocketFragmentState()</div><div class="ttdef"><b>Definition:</b> <a href="nwc_8cpp_source.html#l00429">nwc.cpp:429</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aef169814af2af3b5a32f4f0c30456385" name="aef169814af2af3b5a32f4f0c30456385"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aef169814af2af3b5a32f4f0c30456385">&#9670;&#160;</a></span>fetchBitcoinPrices()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NWC::fetchBitcoinPrices </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nwc_8cpp_source.html#l00667">667</a> of file <a class="el" href="nwc_8cpp_source.html">nwc.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  667</span>                              {</div>
<div class="line"><span class="lineno">  668</span>        <span class="keywordflow">if</span> (!WiFi.isConnected()) {</div>
<div class="line"><span class="lineno">  669</span>            Serial.println(<span class="stringliteral">&quot;WiFi not connected, cannot fetch prices&quot;</span>);</div>
<div class="line"><span class="lineno">  670</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  671</span>        }</div>
<div class="line"><span class="lineno">  672</span>        </div>
<div class="line"><span class="lineno">  673</span>        HTTPClient http;</div>
<div class="line"><span class="lineno">  674</span>        http.begin(<span class="stringliteral">&quot;https://mempool.space/api/v1/prices&quot;</span>);</div>
<div class="line"><span class="lineno">  675</span>        <span class="keywordtype">int</span> httpResponseCode = http.GET();</div>
<div class="line"><span class="lineno">  676</span>        </div>
<div class="line"><span class="lineno">  677</span>        <span class="keywordflow">if</span> (httpResponseCode == 200) {</div>
<div class="line"><span class="lineno">  678</span>            String response = http.getString();</div>
<div class="line"><span class="lineno">  679</span>            updatePricesFromJson(response);</div>
<div class="line"><span class="lineno">  680</span>            last_price_update = millis();</div>
<div class="line"><span class="lineno">  681</span>            prices_loaded = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  682</span>            Serial.println(<span class="stringliteral">&quot;Bitcoin prices updated successfully&quot;</span>);</div>
<div class="line"><span class="lineno">  683</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  684</span>            Serial.printf(<span class="stringliteral">&quot;HTTP request failed with code: %d\\n&quot;</span>, httpResponseCode);</div>
<div class="line"><span class="lineno">  685</span>        }</div>
<div class="line"><span class="lineno">  686</span>        </div>
<div class="line"><span class="lineno">  687</span>        http.end();</div>
<div class="line"><span class="lineno">  688</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a2d1e53d84c677b6b30da4a0b845352d1" name="a2d1e53d84c677b6b30da4a0b845352d1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2d1e53d84c677b6b30da4a0b845352d1">&#9670;&#160;</a></span>getBitcoinPrices()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">long * NWC::getBitcoinPrices </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nwc_8cpp_source.html#l00735">735</a> of file <a class="el" href="nwc_8cpp_source.html">nwc.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  735</span>                             {</div>
<div class="line"><span class="lineno">  736</span>        <span class="keywordflow">return</span> btc_prices;</div>
<div class="line"><span class="lineno">  737</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a75a93db0e7805efd74eb67c4c458a66f" name="a75a93db0e7805efd74eb67c4c458a66f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a75a93db0e7805efd74eb67c4c458a66f">&#9670;&#160;</a></span>getBootTimestamp()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned long NWC::getBootTimestamp </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nwc_8cpp_source.html#l00834">834</a> of file <a class="el" href="nwc_8cpp_source.html">nwc.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  834</span>                                     {</div>
<div class="line"><span class="lineno">  835</span>        <span class="keywordflow">return</span> bootTimestamp;</div>
<div class="line"><span class="lineno">  836</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="ac8bb8a5bfcd2f30e2e35458ceeac24cd" name="ac8bb8a5bfcd2f30e2e35458ceeac24cd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac8bb8a5bfcd2f30e2e35458ceeac24cd">&#9670;&#160;</a></span>getCurrentInvoice()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">String NWC::getCurrentInvoice </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nwc_8cpp_source.html#l00659">659</a> of file <a class="el" href="nwc_8cpp_source.html">nwc.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  659</span>                               {</div>
<div class="line"><span class="lineno">  660</span>        <span class="keywordflow">return</span> current_invoice_str;</div>
<div class="line"><span class="lineno">  661</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="aeaebbdb90bbebb939c1149ad621e9455" name="aeaebbdb90bbebb939c1149ad621e9455"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeaebbdb90bbebb939c1149ad621e9455">&#9670;&#160;</a></span>getLastPriceUpdate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned long NWC::getLastPriceUpdate </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nwc_8cpp_source.html#l00743">743</a> of file <a class="el" href="nwc_8cpp_source.html">nwc.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  743</span>                                       {</div>
<div class="line"><span class="lineno">  744</span>        <span class="keywordflow">return</span> last_price_update;</div>
<div class="line"><span class="lineno">  745</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a21272097203f647bcfc29821d1035eb8" name="a21272097203f647bcfc29821d1035eb8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a21272097203f647bcfc29821d1035eb8">&#9670;&#160;</a></span>getNpubHex()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">String NWC::getNpubHex </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nwc_8cpp_source.html#l00946">946</a> of file <a class="el" href="nwc_8cpp_source.html">nwc.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  946</span>                        {</div>
<div class="line"><span class="lineno">  947</span>        <span class="keywordflow">return</span> npubHexStr;</div>
<div class="line"><span class="lineno">  948</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a8819a0f510ab7fcb3dc3381db3a0eab6" name="a8819a0f510ab7fcb3dc3381db3a0eab6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8819a0f510ab7fcb3dc3381db3a0eab6">&#9670;&#160;</a></span>getNsecHex()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">String NWC::getNsecHex </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nwc_8cpp_source.html#l00942">942</a> of file <a class="el" href="nwc_8cpp_source.html">nwc.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  942</span>                        {</div>
<div class="line"><span class="lineno">  943</span>        <span class="keywordflow">return</span> nsecHexStr;</div>
<div class="line"><span class="lineno">  944</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="ae645013edf0be68e8ea57f7130b136e4" name="ae645013edf0be68e8ea57f7130b136e4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae645013edf0be68e8ea57f7130b136e4">&#9670;&#160;</a></span>getPairingUrl()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">String NWC::getPairingUrl </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nwc_8cpp_source.html#l00280">280</a> of file <a class="el" href="nwc_8cpp_source.html">nwc.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  280</span>                           {</div>
<div class="line"><span class="lineno">  281</span>        <span class="keywordflow">return</span> <a class="code hl_variable" href="ui_8cpp.html#aeaf5a5f752292b6ed1aa766532cd6bc0">nwcPairingUrl</a>;</div>
<div class="line"><span class="lineno">  282</span>    }</div>
<div class="ttc" id="aui_8cpp_html_aeaf5a5f752292b6ed1aa766532cd6bc0"><div class="ttname"><a href="ui_8cpp.html#aeaf5a5f752292b6ed1aa766532cd6bc0">nwcPairingUrl</a></div><div class="ttdeci">String nwcPairingUrl</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="abb2a09968c5b268eef33006b22a32c12" name="abb2a09968c5b268eef33006b22a32c12"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abb2a09968c5b268eef33006b22a32c12">&#9670;&#160;</a></span>getRelayUrl()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">String NWC::getRelayUrl </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nwc_8cpp_source.html#l00934">934</a> of file <a class="el" href="nwc_8cpp_source.html">nwc.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  934</span>                         {</div>
<div class="line"><span class="lineno">  935</span>        <span class="keywordflow">return</span> relayUrl;</div>
<div class="line"><span class="lineno">  936</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a8ef3c6df0ec5f0c7cbec9ee9a180db8f" name="a8ef3c6df0ec5f0c7cbec9ee9a180db8f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8ef3c6df0ec5f0c7cbec9ee9a180db8f">&#9670;&#160;</a></span>getTimeClient()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">NTPClient &amp; NWC::getTimeClient </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nwc_8cpp_source.html#l00838">838</a> of file <a class="el" href="nwc_8cpp_source.html">nwc.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  838</span>                               {</div>
<div class="line"><span class="lineno">  839</span>        <span class="keywordflow">return</span> timeClient;</div>
<div class="line"><span class="lineno">  840</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a08f91f132a611875988ba75c6d196318" name="a08f91f132a611875988ba75c6d196318"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a08f91f132a611875988ba75c6d196318">&#9670;&#160;</a></span>getUnixTimestamp()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned long NWC::getUnixTimestamp </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nwc_8cpp_source.html#l00830">830</a> of file <a class="el" href="nwc_8cpp_source.html">nwc.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  830</span>                                     {</div>
<div class="line"><span class="lineno">  831</span>        <span class="keywordflow">return</span> unixTimestamp;</div>
<div class="line"><span class="lineno">  832</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a8b64dfdf4a3cc775ec132ba31825a340" name="a8b64dfdf4a3cc775ec132ba31825a340"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8b64dfdf4a3cc775ec132ba31825a340">&#9670;&#160;</a></span>getWalletPubKey()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">String NWC::getWalletPubKey </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nwc_8cpp_source.html#l00938">938</a> of file <a class="el" href="nwc_8cpp_source.html">nwc.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  938</span>                             {</div>
<div class="line"><span class="lineno">  939</span>        <span class="keywordflow">return</span> walletPubKey;</div>
<div class="line"><span class="lineno">  940</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="aee89013cd6a45b02d0f848879e96da16" name="aee89013cd6a45b02d0f848879e96da16"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aee89013cd6a45b02d0f848879e96da16">&#9670;&#160;</a></span>getWebSocketClient()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">WebSocketsClient &amp; NWC::getWebSocketClient </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nwc_8cpp_source.html#l00930">930</a> of file <a class="el" href="nwc_8cpp_source.html">nwc.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  930</span>                                           {</div>
<div class="line"><span class="lineno">  931</span>        <span class="keywordflow">return</span> webSocket;</div>
<div class="line"><span class="lineno">  932</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a952c9d2aa4e8bedd3484fd68feefab9b" name="a952c9d2aa4e8bedd3484fd68feefab9b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a952c9d2aa4e8bedd3484fd68feefab9b">&#9670;&#160;</a></span>handleFragment()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NWC::handleFragment </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>payload</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>length</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>isBinary</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>isLast</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nwc_8cpp_source.html#l00883">883</a> of file <a class="el" href="nwc_8cpp_source.html">nwc.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  883</span>                                                                                     {</div>
<div class="line"><span class="lineno">  884</span>        ws_fragment_received_size += length;</div>
<div class="line"><span class="lineno">  885</span>        </div>
<div class="line"><span class="lineno">  886</span>        <span class="keywordflow">if</span> (!isBinary) {</div>
<div class="line"><span class="lineno">  887</span>            ws_fragmented_message += String((<span class="keywordtype">char</span>*)payload);</div>
<div class="line"><span class="lineno">  888</span>        }</div>
<div class="line"><span class="lineno">  889</span>        </div>
<div class="line"><span class="lineno">  890</span>        <span class="keywordflow">if</span> (isLast) {</div>
<div class="line"><span class="lineno">  891</span>            <span class="keywordflow">if</span> (!isBinary) {</div>
<div class="line"><span class="lineno">  892</span>                handleWebsocketMessage(NULL, (uint8_t*)ws_fragmented_message.c_str(), ws_fragmented_message.length());</div>
<div class="line"><span class="lineno">  893</span>            }</div>
<div class="line"><span class="lineno">  894</span>            <a class="code hl_function" href="namespace_n_w_c.html#a870035d4e450773ec8a50d0bf0b81702">resetWebsocketFragmentState</a>();</div>
<div class="line"><span class="lineno">  895</span>        }</div>
<div class="line"><span class="lineno">  896</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a964d9daf0d78f7807e9dffc07d0b00df" name="a964d9daf0d78f7807e9dffc07d0b00df"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a964d9daf0d78f7807e9dffc07d0b00df">&#9670;&#160;</a></span>handleNwcNip04NotificationEvent()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NWC::handleNwcNip04NotificationEvent </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nwc_8cpp_source.html#l00556">556</a> of file <a class="el" href="nwc_8cpp_source.html">nwc.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  556</span>                                                        {</div>
<div class="line"><span class="lineno">  557</span>        Serial.println(<span class="stringliteral">&quot;Handling NWC NIP-04 notification event (kind 23196)&quot;</span>);</div>
<div class="line"><span class="lineno">  558</span>        <span class="comment">// Implementation would go here</span></div>
<div class="line"><span class="lineno">  559</span>        <span class="comment">// This would handle NIP-04 encrypted notifications</span></div>
<div class="line"><span class="lineno">  560</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a226efbf68836ffd12773687ebece1f06" name="a226efbf68836ffd12773687ebece1f06"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a226efbf68836ffd12773687ebece1f06">&#9670;&#160;</a></span>handleNwcNip44NotificationEvent()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NWC::handleNwcNip44NotificationEvent </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nwc_8cpp_source.html#l00562">562</a> of file <a class="el" href="nwc_8cpp_source.html">nwc.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  562</span>                                                        {</div>
<div class="line"><span class="lineno">  563</span>        Serial.println(<span class="stringliteral">&quot;Handling NWC NIP-44 notification event (kind 23197)&quot;</span>);</div>
<div class="line"><span class="lineno">  564</span>        <span class="comment">// Implementation would go here</span></div>
<div class="line"><span class="lineno">  565</span>        <span class="comment">// This would handle NIP-44 encrypted notifications</span></div>
<div class="line"><span class="lineno">  566</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a2ea8f4d93d51274c1ed01f85eadeb3c1" name="a2ea8f4d93d51274c1ed01f85eadeb3c1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2ea8f4d93d51274c1ed01f85eadeb3c1">&#9670;&#160;</a></span>handleNwcResponseEvent()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NWC::handleNwcResponseEvent </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nwc_8cpp_source.html#l00438">438</a> of file <a class="el" href="nwc_8cpp_source.html">nwc.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  438</span>                                               {</div>
<div class="line"><span class="lineno">  439</span>        Serial.println(<span class="stringliteral">&quot;Handling NWC response event (kind 23195)&quot;</span>);</div>
<div class="line"><span class="lineno">  440</span>        </div>
<div class="line"><span class="lineno">  441</span>        String message = String((<span class="keywordtype">char</span>*)data);</div>
<div class="line"><span class="lineno">  442</span>        </div>
<div class="line"><span class="lineno">  443</span>        <span class="comment">// Parse the event message</span></div>
<div class="line"><span class="lineno">  444</span>        DynamicJsonDocument eventDoc(2048);</div>
<div class="line"><span class="lineno">  445</span>        DeserializationError error = deserializeJson(eventDoc, message);</div>
<div class="line"><span class="lineno">  446</span>        </div>
<div class="line"><span class="lineno">  447</span>        <span class="keywordflow">if</span> (error) {</div>
<div class="line"><span class="lineno">  448</span>            Serial.print(<span class="stringliteral">&quot;JSON parsing failed: &quot;</span>);</div>
<div class="line"><span class="lineno">  449</span>            Serial.println(error.c_str());</div>
<div class="line"><span class="lineno">  450</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  451</span>        }</div>
<div class="line"><span class="lineno">  452</span>        </div>
<div class="line"><span class="lineno">  453</span>        <span class="comment">// Extract event content</span></div>
<div class="line"><span class="lineno">  454</span>        JsonObject <span class="keyword">event</span> = eventDoc[2];</div>
<div class="line"><span class="lineno">  455</span>        String content = <span class="keyword">event</span>[<span class="stringliteral">&quot;content&quot;</span>];</div>
<div class="line"><span class="lineno">  456</span>        String thirdPartyPubKey = <span class="keyword">event</span>[<span class="stringliteral">&quot;pubkey&quot;</span>];</div>
<div class="line"><span class="lineno">  457</span>        </div>
<div class="line"><span class="lineno">  458</span>        Serial.println(<span class="stringliteral">&quot;Third Party PubKey: &quot;</span> + thirdPartyPubKey);</div>
<div class="line"><span class="lineno">  459</span>        Serial.println(<span class="stringliteral">&quot;Cipher Text: &quot;</span> + content);</div>
<div class="line"><span class="lineno">  460</span>        </div>
<div class="line"><span class="lineno">  461</span>        <span class="keywordflow">if</span> (content.length() == 0 || thirdPartyPubKey.length() == 0) {</div>
<div class="line"><span class="lineno">  462</span>            Serial.println(<span class="stringliteral">&quot;Failed to extract content or pubkey from event&quot;</span>);</div>
<div class="line"><span class="lineno">  463</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  464</span>        }</div>
<div class="line"><span class="lineno">  465</span>        </div>
<div class="line"><span class="lineno">  466</span>        <span class="comment">// Decrypt the response</span></div>
<div class="line"><span class="lineno">  467</span>        String decryptedResponse = <a class="code hl_function" href="namespacenostr.html#ad76c1eacccd66757ef146e3393a1442a">nostr::decryptNip04Ciphertext</a>(content, nsecHexStr.c_str(), thirdPartyPubKey);</div>
<div class="line"><span class="lineno">  468</span>        Serial.println(<span class="stringliteral">&quot;Decrypted Response: &quot;</span> + decryptedResponse);</div>
<div class="line"><span class="lineno">  469</span>        </div>
<div class="line"><span class="lineno">  470</span>        <span class="comment">// Parse the decrypted response</span></div>
<div class="line"><span class="lineno">  471</span>        DynamicJsonDocument decryptedResponseDoc(1024);</div>
<div class="line"><span class="lineno">  472</span>        deserializeJson(decryptedResponseDoc, decryptedResponse);</div>
<div class="line"><span class="lineno">  473</span>        String resultType = decryptedResponseDoc[<span class="stringliteral">&quot;result_type&quot;</span>];</div>
<div class="line"><span class="lineno">  474</span>        Serial.println(<span class="stringliteral">&quot;Result Type: &quot;</span> + resultType);</div>
<div class="line"><span class="lineno">  475</span>        </div>
<div class="line"><span class="lineno">  476</span>        <span class="keywordflow">if</span> (resultType == <span class="stringliteral">&quot;make_invoice&quot;</span>) {</div>
<div class="line"><span class="lineno">  477</span>            Serial.println(<span class="stringliteral">&quot;=== Processing make_invoice result ===&quot;</span>);</div>
<div class="line"><span class="lineno">  478</span>            Serial.println(<span class="stringliteral">&quot;Free heap before processing: &quot;</span> + String(ESP.getFreeHeap()));</div>
<div class="line"><span class="lineno">  479</span>            </div>
<div class="line"><span class="lineno">  480</span>            JsonObject result = decryptedResponseDoc[<span class="stringliteral">&quot;result&quot;</span>];</div>
<div class="line"><span class="lineno">  481</span>            </div>
<div class="line"><span class="lineno">  482</span>            <span class="comment">// Check if result object is valid</span></div>
<div class="line"><span class="lineno">  483</span>            <span class="keywordflow">if</span> (result.isNull()) {</div>
<div class="line"><span class="lineno">  484</span>                Serial.println(<span class="stringliteral">&quot;ERROR: Result object is null!&quot;</span>);</div>
<div class="line"><span class="lineno">  485</span>                <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  486</span>            }</div>
<div class="line"><span class="lineno">  487</span>            </div>
<div class="line"><span class="lineno">  488</span>            String invoice = result[<span class="stringliteral">&quot;invoice&quot;</span>].as&lt;String&gt;();</div>
<div class="line"><span class="lineno">  489</span>            String description = result[<span class="stringliteral">&quot;description&quot;</span>];</div>
<div class="line"><span class="lineno">  490</span>            <span class="keywordtype">int</span> amount = result[<span class="stringliteral">&quot;amount&quot;</span>];</div>
<div class="line"><span class="lineno">  491</span>            </div>
<div class="line"><span class="lineno">  492</span>            Serial.println(<span class="stringliteral">&quot;Invoice: &quot;</span> + invoice);</div>
<div class="line"><span class="lineno">  493</span>            Serial.println(<span class="stringliteral">&quot;Description: &quot;</span> + description);</div>
<div class="line"><span class="lineno">  494</span>            Serial.println(<span class="stringliteral">&quot;Amount: &quot;</span> + String(amount) + <span class="stringliteral">&quot; msats&quot;</span>);</div>
<div class="line"><span class="lineno">  495</span>            Serial.println(<span class="stringliteral">&quot;Invoice validity check: &quot;</span> + String(invoice.length() &gt; 0 ? <span class="stringliteral">&quot;VALID&quot;</span> : <span class="stringliteral">&quot;INVALID&quot;</span>));</div>
<div class="line"><span class="lineno">  496</span>            </div>
<div class="line"><span class="lineno">  497</span>            <span class="keywordflow">if</span> (invoice.length() == 0) {</div>
<div class="line"><span class="lineno">  498</span>                Serial.println(<span class="stringliteral">&quot;ERROR: Empty invoice received!&quot;</span>);</div>
<div class="line"><span class="lineno">  499</span>                <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  500</span>            }</div>
<div class="line"><span class="lineno">  501</span>            </div>
<div class="line"><span class="lineno">  502</span>            <span class="comment">// Store the current invoice</span></div>
<div class="line"><span class="lineno">  503</span>            Serial.println(<span class="stringliteral">&quot;Storing current invoice...&quot;</span>);</div>
<div class="line"><span class="lineno">  504</span>            <a class="code hl_function" href="namespace_n_w_c.html#a4e5666c5f59ca4d455e2148a3f06d329">setCurrentInvoice</a>(invoice);</div>
<div class="line"><span class="lineno">  505</span>            Serial.println(<span class="stringliteral">&quot;Invoice stored successfully&quot;</span>);</div>
<div class="line"><span class="lineno">  506</span>            </div>
<div class="line"><span class="lineno">  507</span>            Serial.println(<span class="stringliteral">&quot;Free heap before UI update: &quot;</span> + String(ESP.getFreeHeap()));</div>
<div class="line"><span class="lineno">  508</span>            </div>
<div class="line"><span class="lineno">  509</span>            <span class="comment">// Notify the App module that invoice was created</span></div>
<div class="line"><span class="lineno">  510</span>            <span class="comment">// App::notifyInvoiceCreated(invoice) will be called externally</span></div>
<div class="line"><span class="lineno">  511</span>            Serial.println(<span class="stringliteral">&quot;Calling UI::updateInvoiceDisplay...&quot;</span>);</div>
<div class="line"><span class="lineno">  512</span>            <a class="code hl_function" href="namespace_u_i.html#a69ebc6c2a7039e77b2a0c8e3b4d2235d">UI::updateInvoiceDisplay</a>(invoice, amount / 1000); <span class="comment">// Convert msats to sats</span></div>
<div class="line"><span class="lineno">  513</span>            Serial.println(<span class="stringliteral">&quot;UI::updateInvoiceDisplay completed&quot;</span>);</div>
<div class="line"><span class="lineno">  514</span>            </div>
<div class="line"><span class="lineno">  515</span>            Serial.println(<span class="stringliteral">&quot;Free heap after UI update: &quot;</span> + String(ESP.getFreeHeap()));</div>
<div class="line"><span class="lineno">  516</span>            </div>
<div class="line"><span class="lineno">  517</span>            <span class="comment">// Start watching for payment notifications</span></div>
<div class="line"><span class="lineno">  518</span>            Serial.println(<span class="stringliteral">&quot;Starting invoice notification watchdog...&quot;</span>);</div>
<div class="line"><span class="lineno">  519</span>            <a class="code hl_function" href="namespace_n_w_c.html#a209d5a499b7718c1a0d5984a191091a9">startInvoiceNotificationWatchdog</a>();</div>
<div class="line"><span class="lineno">  520</span>            </div>
<div class="line"><span class="lineno">  521</span>            <span class="comment">// Start invoice lookup timer (after 3 seconds)</span></div>
<div class="line"><span class="lineno">  522</span>            Serial.println(<span class="stringliteral">&quot;Starting invoice lookup timer...&quot;</span>);</div>
<div class="line"><span class="lineno">  523</span>            <a class="code hl_function" href="namespace_n_w_c.html#a1c4b50b7a22b309f6b6f3ddcf9f32a74">startInvoiceLookupTimer</a>();</div>
<div class="line"><span class="lineno">  524</span>            Serial.println(<span class="stringliteral">&quot;=== make_invoice processing completed ===&quot;</span>);</div>
<div class="line"><span class="lineno">  525</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (resultType == <span class="stringliteral">&quot;lookup_invoice&quot;</span>) {</div>
<div class="line"><span class="lineno">  526</span>            Serial.println(<span class="stringliteral">&quot;Received lookup_invoice response:&quot;</span>);</div>
<div class="line"><span class="lineno">  527</span>            String resultJson;</div>
<div class="line"><span class="lineno">  528</span>            serializeJson(decryptedResponseDoc[<span class="stringliteral">&quot;result&quot;</span>], resultJson);</div>
<div class="line"><span class="lineno">  529</span>            Serial.println(resultJson);</div>
<div class="line"><span class="lineno">  530</span> </div>
<div class="line"><span class="lineno">  531</span>            Serial.println(<span class="stringliteral">&quot;Settled at value is: &quot;</span> + decryptedResponseDoc[<span class="stringliteral">&quot;result&quot;</span>][<span class="stringliteral">&quot;settled_at&quot;</span>].as&lt;String&gt;());</div>
<div class="line"><span class="lineno">  532</span>            </div>
<div class="line"><span class="lineno">  533</span>            <span class="comment">// check if settled at is a timestamp</span></div>
<div class="line"><span class="lineno">  534</span>            <span class="keywordflow">if</span> (decryptedResponseDoc[<span class="stringliteral">&quot;result&quot;</span>].containsKey(<span class="stringliteral">&quot;settled_at&quot;</span>) &amp;&amp; decryptedResponseDoc[<span class="stringliteral">&quot;result&quot;</span>][<span class="stringliteral">&quot;settled_at&quot;</span>] &gt;= 1231006505) {</div>
<div class="line"><span class="lineno">  535</span>                Serial.println(<span class="stringliteral">&quot;Invoice is settled (paid).&quot;</span>);</div>
<div class="line"><span class="lineno">  536</span>                </div>
<div class="line"><span class="lineno">  537</span>                <span class="comment">// Stop the lookup timer</span></div>
<div class="line"><span class="lineno">  538</span>                <a class="code hl_function" href="namespace_n_w_c.html#a1dd636b9104cd24b5d2fbd91329a67cd">stopInvoiceLookupTimer</a>();</div>
<div class="line"><span class="lineno">  539</span>                </div>
<div class="line"><span class="lineno">  540</span>                <span class="comment">// Stop the notification watchdog</span></div>
<div class="line"><span class="lineno">  541</span>                <a class="code hl_function" href="namespace_n_w_c.html#a9a72ecf2c1ad80aafcb1d1a79651d0aa">stopInvoiceNotificationWatchdog</a>();</div>
<div class="line"><span class="lineno">  542</span>                </div>
<div class="line"><span class="lineno">  543</span>                <span class="comment">// Notify payment received</span></div>
<div class="line"><span class="lineno">  544</span>                Serial.println(<span class="stringliteral">&quot;Payment received - updating UI&quot;</span>);</div>
<div class="line"><span class="lineno">  545</span>                <a class="code hl_function" href="namespace_u_i.html#a85a9c95d4c743ddadfb3d0e8a4833482">UI::showPaymentReceived</a>();</div>
<div class="line"><span class="lineno">  546</span>                </div>
<div class="line"><span class="lineno">  547</span>                <span class="comment">// Clear the current invoice</span></div>
<div class="line"><span class="lineno">  548</span>                <a class="code hl_function" href="namespace_n_w_c.html#a4e5666c5f59ca4d455e2148a3f06d329">setCurrentInvoice</a>(<span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><span class="lineno">  549</span>                </div>
<div class="line"><span class="lineno">  550</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  551</span>                Serial.println(<span class="stringliteral">&quot;Invoice is not settled yet.&quot;</span>);</div>
<div class="line"><span class="lineno">  552</span>            }</div>
<div class="line"><span class="lineno">  553</span>        }</div>
<div class="line"><span class="lineno">  554</span>    }</div>
<div class="ttc" id="anamespace_n_w_c_html_a1c4b50b7a22b309f6b6f3ddcf9f32a74"><div class="ttname"><a href="namespace_n_w_c.html#a1c4b50b7a22b309f6b6f3ddcf9f32a74">NWC::startInvoiceLookupTimer</a></div><div class="ttdeci">void startInvoiceLookupTimer()</div><div class="ttdef"><b>Definition:</b> <a href="nwc_8cpp_source.html#l00646">nwc.cpp:646</a></div></div>
<div class="ttc" id="anamespace_n_w_c_html_a1dd636b9104cd24b5d2fbd91329a67cd"><div class="ttname"><a href="namespace_n_w_c.html#a1dd636b9104cd24b5d2fbd91329a67cd">NWC::stopInvoiceLookupTimer</a></div><div class="ttdeci">void stopInvoiceLookupTimer()</div><div class="ttdef"><b>Definition:</b> <a href="nwc_8cpp_source.html#l00652">nwc.cpp:652</a></div></div>
<div class="ttc" id="anamespace_n_w_c_html_a209d5a499b7718c1a0d5984a191091a9"><div class="ttname"><a href="namespace_n_w_c.html#a209d5a499b7718c1a0d5984a191091a9">NWC::startInvoiceNotificationWatchdog</a></div><div class="ttdeci">void startInvoiceNotificationWatchdog()</div><div class="ttdef"><b>Definition:</b> <a href="nwc_8cpp_source.html#l00633">nwc.cpp:633</a></div></div>
<div class="ttc" id="anamespace_n_w_c_html_a4e5666c5f59ca4d455e2148a3f06d329"><div class="ttname"><a href="namespace_n_w_c.html#a4e5666c5f59ca4d455e2148a3f06d329">NWC::setCurrentInvoice</a></div><div class="ttdeci">void setCurrentInvoice(const String &amp;invoice)</div><div class="ttdef"><b>Definition:</b> <a href="nwc_8cpp_source.html#l00663">nwc.cpp:663</a></div></div>
<div class="ttc" id="anamespace_n_w_c_html_a9a72ecf2c1ad80aafcb1d1a79651d0aa"><div class="ttname"><a href="namespace_n_w_c.html#a9a72ecf2c1ad80aafcb1d1a79651d0aa">NWC::stopInvoiceNotificationWatchdog</a></div><div class="ttdeci">void stopInvoiceNotificationWatchdog()</div><div class="ttdef"><b>Definition:</b> <a href="nwc_8cpp_source.html#l00639">nwc.cpp:639</a></div></div>
<div class="ttc" id="anamespace_u_i_html_a69ebc6c2a7039e77b2a0c8e3b4d2235d"><div class="ttname"><a href="namespace_u_i.html#a69ebc6c2a7039e77b2a0c8e3b4d2235d">UI::updateInvoiceDisplay</a></div><div class="ttdeci">void updateInvoiceDisplay(const String &amp;invoice, int amount_sats)</div><div class="ttdef"><b>Definition:</b> <a href="ui_8cpp_source.html#l00902">ui.cpp:902</a></div></div>
<div class="ttc" id="anamespace_u_i_html_a85a9c95d4c743ddadfb3d0e8a4833482"><div class="ttname"><a href="namespace_u_i.html#a85a9c95d4c743ddadfb3d0e8a4833482">UI::showPaymentReceived</a></div><div class="ttdeci">void showPaymentReceived()</div><div class="ttdef"><b>Definition:</b> <a href="ui_8cpp_source.html#l00958">ui.cpp:958</a></div></div>
<div class="ttc" id="anamespacenostr_html_ad76c1eacccd66757ef146e3393a1442a"><div class="ttname"><a href="namespacenostr.html#ad76c1eacccd66757ef146e3393a1442a">nostr::decryptNip04Ciphertext</a></div><div class="ttdeci">String decryptNip04Ciphertext(String &amp;cipherText, String privateKeyHex, String senderPubKeyHex)</div><div class="ttdef"><b>Definition:</b> <a href="nostr_8cpp_source.html#l00080">nostr.cpp:80</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a18f2ad2c95003389637ea9d84d18d5cf" name="a18f2ad2c95003389637ea9d84d18d5cf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a18f2ad2c95003389637ea9d84d18d5cf">&#9670;&#160;</a></span>handleWebsocketMessage()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NWC::handleWebsocketMessage </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>arg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nwc_8cpp_source.html#l00391">391</a> of file <a class="el" href="nwc_8cpp_source.html">nwc.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  391</span>                                                                      {</div>
<div class="line"><span class="lineno">  392</span>        String message = String((<span class="keywordtype">char</span>*)data);</div>
<div class="line"><span class="lineno">  393</span>        Serial.println(<span class="stringliteral">&quot;Processing WebSocket message: &quot;</span> + message);</div>
<div class="line"><span class="lineno">  394</span>        </div>
<div class="line"><span class="lineno">  395</span>        <span class="comment">// Parse JSON message</span></div>
<div class="line"><span class="lineno">  396</span>        DynamicJsonDocument doc(4096);</div>
<div class="line"><span class="lineno">  397</span>        DeserializationError error = deserializeJson(doc, message);</div>
<div class="line"><span class="lineno">  398</span>        </div>
<div class="line"><span class="lineno">  399</span>        <span class="keywordflow">if</span> (error) {</div>
<div class="line"><span class="lineno">  400</span>            Serial.println(<span class="stringliteral">&quot;Failed to parse JSON message&quot;</span>);</div>
<div class="line"><span class="lineno">  401</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  402</span>        }</div>
<div class="line"><span class="lineno">  403</span>        </div>
<div class="line"><span class="lineno">  404</span>        <span class="comment">// Check if it&#39;s an event array</span></div>
<div class="line"><span class="lineno">  405</span>        <span class="keywordflow">if</span> (doc.is&lt;JsonArray&gt;() &amp;&amp; doc.size() &gt;= 3) {</div>
<div class="line"><span class="lineno">  406</span>            String messageType = doc[0];</div>
<div class="line"><span class="lineno">  407</span>            <span class="keywordflow">if</span> (messageType == <span class="stringliteral">&quot;EVENT&quot;</span>) {</div>
<div class="line"><span class="lineno">  408</span>                JsonObject <span class="keyword">event</span> = doc[2];</div>
<div class="line"><span class="lineno">  409</span>                <span class="keywordtype">int</span> kind = <span class="keyword">event</span>[<span class="stringliteral">&quot;kind&quot;</span>];</div>
<div class="line"><span class="lineno">  410</span>                </div>
<div class="line"><span class="lineno">  411</span>                <span class="keywordflow">switch</span> (kind) {</div>
<div class="line"><span class="lineno">  412</span>                    <span class="keywordflow">case</span> 23195:</div>
<div class="line"><span class="lineno">  413</span>                        handleNwcResponseEvent(data);</div>
<div class="line"><span class="lineno">  414</span>                        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  415</span>                    <span class="keywordflow">case</span> 23196:</div>
<div class="line"><span class="lineno">  416</span>                        handleNwcNip04NotificationEvent(data);</div>
<div class="line"><span class="lineno">  417</span>                        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  418</span>                    <span class="keywordflow">case</span> 23197:</div>
<div class="line"><span class="lineno">  419</span>                        handleNwcNip44NotificationEvent(data);</div>
<div class="line"><span class="lineno">  420</span>                        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  421</span>                    <span class="keywordflow">default</span>:</div>
<div class="line"><span class="lineno">  422</span>                        Serial.println(<span class="stringliteral">&quot;Received event with unknown kind: &quot;</span> + String(kind));</div>
<div class="line"><span class="lineno">  423</span>                        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  424</span>                }</div>
<div class="line"><span class="lineno">  425</span>            }</div>
<div class="line"><span class="lineno">  426</span>        }</div>
<div class="line"><span class="lineno">  427</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a1c1d9172198a60da5d26688610968af8" name="a1c1d9172198a60da5d26688610968af8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1c1d9172198a60da5d26688610968af8">&#9670;&#160;</a></span>init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NWC::init </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nwc_8cpp_source.html#l00068">68</a> of file <a class="el" href="nwc_8cpp_source.html">nwc.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   68</span>                {</div>
<div class="line"><span class="lineno">   69</span>        <span class="comment">// Initialize Nostr memory space</span></div>
<div class="line"><span class="lineno">   70</span>        <a class="code hl_function" href="namespacenostr.html#ad38d4b13131e9c51ec482ccfcbc32841">nostr::initMemorySpace</a>(2048, 2048);</div>
<div class="line"><span class="lineno">   71</span>        </div>
<div class="line"><span class="lineno">   72</span>        timeClient.begin();</div>
<div class="line"><span class="lineno">   73</span>        timeClient.setTimeOffset(0);</div>
<div class="line"><span class="lineno">   74</span>        bootTimestamp = millis();</div>
<div class="line"><span class="lineno">   75</span>        </div>
<div class="line"><span class="lineno">   76</span>        <span class="comment">// Initialize connection tracking variables</span></div>
<div class="line"><span class="lineno">   77</span>        last_ws_message_received = millis();</div>
<div class="line"><span class="lineno">   78</span>        last_connection_health_check = millis();</div>
<div class="line"><span class="lineno">   79</span>        reconnection_attempts = 0;</div>
<div class="line"><span class="lineno">   80</span>        </div>
<div class="line"><span class="lineno">   81</span>        <span class="comment">// Load NWC URL from preferences</span></div>
<div class="line"><span class="lineno">   82</span>        <a class="code hl_function" href="namespace_n_w_c.html#a12351ef57b22b79c192426979a938cc3">loadUrlFromPreferences</a>();</div>
<div class="line"><span class="lineno">   83</span>        </div>
<div class="line"><span class="lineno">   84</span>        <span class="comment">// Setup NWC data if URL is available</span></div>
<div class="line"><span class="lineno">   85</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="ui_8cpp.html#aeaf5a5f752292b6ed1aa766532cd6bc0">nwcPairingUrl</a>.length() &gt; 0) {</div>
<div class="line"><span class="lineno">   86</span>            <a class="code hl_function" href="namespace_n_w_c.html#a99fdb7cc9f77370099522b3461ad84ab">setupData</a>(<a class="code hl_variable" href="ui_8cpp.html#aeaf5a5f752292b6ed1aa766532cd6bc0">nwcPairingUrl</a>);</div>
<div class="line"><span class="lineno">   87</span>        }</div>
<div class="line"><span class="lineno">   88</span>    }</div>
<div class="ttc" id="anamespace_n_w_c_html_a12351ef57b22b79c192426979a938cc3"><div class="ttname"><a href="namespace_n_w_c.html#a12351ef57b22b79c192426979a938cc3">NWC::loadUrlFromPreferences</a></div><div class="ttdeci">void loadUrlFromPreferences()</div><div class="ttdef"><b>Definition:</b> <a href="nwc_8cpp_source.html#l00260">nwc.cpp:260</a></div></div>
<div class="ttc" id="anamespace_n_w_c_html_a99fdb7cc9f77370099522b3461ad84ab"><div class="ttname"><a href="namespace_n_w_c.html#a99fdb7cc9f77370099522b3461ad84ab">NWC::setupData</a></div><div class="ttdeci">void setupData(const String &amp;url)</div><div class="ttdef"><b>Definition:</b> <a href="nwc_8cpp_source.html#l00105">nwc.cpp:105</a></div></div>
<div class="ttc" id="anamespacenostr_html_ad38d4b13131e9c51ec482ccfcbc32841"><div class="ttname"><a href="namespacenostr.html#ad38d4b13131e9c51ec482ccfcbc32841">nostr::initMemorySpace</a></div><div class="ttdeci">void initMemorySpace(size_t nostrEventDocCapacity, size_t encryptedMessageBinSize)</div><div class="ttdef"><b>Definition:</b> <a href="nostr_8cpp_source.html#l00027">nostr.cpp:27</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a8a33716d68e6fc7b598f13474a8aa3d0" name="a8a33716d68e6fc7b598f13474a8aa3d0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8a33716d68e6fc7b598f13474a8aa3d0">&#9670;&#160;</a></span>invoiceLookupTimerCallback()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NWC::invoiceLookupTimerCallback </td>
          <td>(</td>
          <td class="paramtype">lv_timer_t *&#160;</td>
          <td class="paramname"><em>timer</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nwc_8cpp_source.html#l00898">898</a> of file <a class="el" href="nwc_8cpp_source.html">nwc.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  898</span>                                                       {</div>
<div class="line"><span class="lineno">  899</span>        <span class="comment">// Check if invoice processing is still active</span></div>
<div class="line"><span class="lineno">  900</span>        <span class="keywordflow">if</span> (!<a class="code hl_function" href="namespace_u_i.html#a256c4320af439732def9402342903462">UI::isInvoiceProcessing</a>()) {</div>
<div class="line"><span class="lineno">  901</span>            Serial.println(<span class="stringliteral">&quot;Invoice lookup cancelled - overlay not active&quot;</span>);</div>
<div class="line"><span class="lineno">  902</span>            <a class="code hl_function" href="namespace_n_w_c.html#a1dd636b9104cd24b5d2fbd91329a67cd">stopInvoiceLookupTimer</a>();</div>
<div class="line"><span class="lineno">  903</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  904</span>        }</div>
<div class="line"><span class="lineno">  905</span>        </div>
<div class="line"><span class="lineno">  906</span>        <span class="comment">// Don&#39;t send lookup requests during light sleep (unless invoice is active)</span></div>
<div class="line"><span class="lineno">  907</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="namespace_app.html#ac4ecbc30cf2ce9769c0dd6fab5e5a364">App::isInLightSleep</a>()) {</div>
<div class="line"><span class="lineno">  908</span>            Serial.println(<span class="stringliteral">&quot;Invoice lookup skipped - device in light sleep&quot;</span>);</div>
<div class="line"><span class="lineno">  909</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  910</span>        }</div>
<div class="line"><span class="lineno">  911</span>        </div>
<div class="line"><span class="lineno">  912</span>        <a class="code hl_function" href="namespace_n_w_c.html#a86b3f2617b12ae02c2e60ea915a43076">sendInvoiceLookupRequest</a>();</div>
<div class="line"><span class="lineno">  913</span>    }</div>
<div class="ttc" id="anamespace_app_html_ac4ecbc30cf2ce9769c0dd6fab5e5a364"><div class="ttname"><a href="namespace_app.html#ac4ecbc30cf2ce9769c0dd6fab5e5a364">App::isInLightSleep</a></div><div class="ttdeci">bool isInLightSleep()</div><div class="ttdef"><b>Definition:</b> <a href="app_8cpp_source.html#l00713">app.cpp:713</a></div></div>
<div class="ttc" id="anamespace_n_w_c_html_a86b3f2617b12ae02c2e60ea915a43076"><div class="ttname"><a href="namespace_n_w_c.html#a86b3f2617b12ae02c2e60ea915a43076">NWC::sendInvoiceLookupRequest</a></div><div class="ttdeci">void sendInvoiceLookupRequest()</div><div class="ttdef"><b>Definition:</b> <a href="nwc_8cpp_source.html#l00602">nwc.cpp:602</a></div></div>
<div class="ttc" id="anamespace_u_i_html_a256c4320af439732def9402342903462"><div class="ttname"><a href="namespace_u_i.html#a256c4320af439732def9402342903462">UI::isInvoiceProcessing</a></div><div class="ttdeci">bool isInvoiceProcessing()</div><div class="ttdef"><b>Definition:</b> <a href="ui_8cpp_source.html#l01333">ui.cpp:1333</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a8f8ca7e2372b1dce642bba4ad410d190" name="a8f8ca7e2372b1dce642bba4ad410d190"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8f8ca7e2372b1dce642bba4ad410d190">&#9670;&#160;</a></span>invoiceNotificationWatchdogCallback()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NWC::invoiceNotificationWatchdogCallback </td>
          <td>(</td>
          <td class="paramtype">lv_timer_t *&#160;</td>
          <td class="paramname"><em>timer</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nwc_8cpp_source.html#l00915">915</a> of file <a class="el" href="nwc_8cpp_source.html">nwc.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  915</span>                                                                {</div>
<div class="line"><span class="lineno">  916</span>        Serial.println(<span class="stringliteral">&quot;Invoice notification watchdog timer fired&quot;</span>);</div>
<div class="line"><span class="lineno">  917</span>        <span class="comment">// Implementation would handle invoice timeout</span></div>
<div class="line"><span class="lineno">  918</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="aa2e749abffc8f1f4995bb52e3a6e8f47" name="aa2e749abffc8f1f4995bb52e3a6e8f47"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa2e749abffc8f1f4995bb52e3a6e8f47">&#9670;&#160;</a></span>isConnected()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool NWC::isConnected </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nwc_8cpp_source.html#l00256">256</a> of file <a class="el" href="nwc_8cpp_source.html">nwc.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  256</span>                       {</div>
<div class="line"><span class="lineno">  257</span>        <span class="keywordflow">return</span> webSocket.isConnected();</div>
<div class="line"><span class="lineno">  258</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="acbeaaf60838294051dacb43171560fbf" name="acbeaaf60838294051dacb43171560fbf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acbeaaf60838294051dacb43171560fbf">&#9670;&#160;</a></span>isFragmentInProgress()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool NWC::isFragmentInProgress </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nwc_8cpp_source.html#l00879">879</a> of file <a class="el" href="nwc_8cpp_source.html">nwc.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  879</span>                                {</div>
<div class="line"><span class="lineno">  880</span>        <span class="keywordflow">return</span> ws_fragment_in_progress;</div>
<div class="line"><span class="lineno">  881</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a15d4ed6dee9570b25a02a7fe34b9ece0" name="a15d4ed6dee9570b25a02a7fe34b9ece0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a15d4ed6dee9570b25a02a7fe34b9ece0">&#9670;&#160;</a></span>isInitialized()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool NWC::isInitialized </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nwc_8cpp_source.html#l00252">252</a> of file <a class="el" href="nwc_8cpp_source.html">nwc.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  252</span>                         {</div>
<div class="line"><span class="lineno">  253</span>        <span class="keywordflow">return</span> <a class="code hl_variable" href="ui_8cpp.html#a948b1584cfc5c1cf91af9d43729abf48">nwc_initialized</a>;</div>
<div class="line"><span class="lineno">  254</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a12351ef57b22b79c192426979a938cc3" name="a12351ef57b22b79c192426979a938cc3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a12351ef57b22b79c192426979a938cc3">&#9670;&#160;</a></span>loadUrlFromPreferences()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NWC::loadUrlFromPreferences </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nwc_8cpp_source.html#l00260">260</a> of file <a class="el" href="nwc_8cpp_source.html">nwc.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  260</span>                                  {</div>
<div class="line"><span class="lineno">  261</span>        preferences.begin(<span class="stringliteral">&quot;nwc-config&quot;</span>, <span class="keyword">true</span>);</div>
<div class="line"><span class="lineno">  262</span>        String saved_url = preferences.getString(<span class="stringliteral">&quot;nwc_url&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><span class="lineno">  263</span>        preferences.end();</div>
<div class="line"><span class="lineno">  264</span>        </div>
<div class="line"><span class="lineno">  265</span>        <span class="keywordflow">if</span> (saved_url.length() &gt; 0) {</div>
<div class="line"><span class="lineno">  266</span>            <a class="code hl_variable" href="ui_8cpp.html#aeaf5a5f752292b6ed1aa766532cd6bc0">nwcPairingUrl</a> = saved_url;</div>
<div class="line"><span class="lineno">  267</span>            Serial.println(<span class="stringliteral">&quot;Loaded NWC URL from preferences: &quot;</span> + <a class="code hl_variable" href="ui_8cpp.html#aeaf5a5f752292b6ed1aa766532cd6bc0">nwcPairingUrl</a>);</div>
<div class="line"><span class="lineno">  268</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  269</span>            Serial.println(<span class="stringliteral">&quot;No saved NWC URL found, using default&quot;</span>);</div>
<div class="line"><span class="lineno">  270</span>        }</div>
<div class="line"><span class="lineno">  271</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a5d747ef50eeb74cee5612fd939452183" name="a5d747ef50eeb74cee5612fd939452183"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5d747ef50eeb74cee5612fd939452183">&#9670;&#160;</a></span>makeInvoice()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NWC::makeInvoice </td>
          <td>(</td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>amount</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const String &amp;&#160;</td>
          <td class="paramname"><em>currency</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nwc_8cpp_source.html#l00568">568</a> of file <a class="el" href="nwc_8cpp_source.html">nwc.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  568</span>                                                           {</div>
<div class="line"><span class="lineno">  569</span>        <span class="keywordflow">if</span> (!<a class="code hl_function" href="namespace_n_w_c.html#aa2e749abffc8f1f4995bb52e3a6e8f47">isConnected</a>()) {</div>
<div class="line"><span class="lineno">  570</span>            Serial.println(<span class="stringliteral">&quot;WebSocket not connected, cannot create invoice&quot;</span>);</div>
<div class="line"><span class="lineno">  571</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  572</span>        }</div>
<div class="line"><span class="lineno">  573</span>        </div>
<div class="line"><span class="lineno">  574</span>        <span class="comment">// Calculate sats based on entered amount and selected currency</span></div>
<div class="line"><span class="lineno">  575</span>        <span class="keywordtype">int</span> amount_sats;</div>
<div class="line"><span class="lineno">  576</span>        <span class="keywordflow">if</span> (currency == <span class="stringliteral">&quot;sats&quot;</span>) {</div>
<div class="line"><span class="lineno">  577</span>            amount_sats = (int)amount;</div>
<div class="line"><span class="lineno">  578</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  579</span>            amount_sats = <a class="code hl_function" href="namespace_n_w_c.html#adf733f5382e816e1e45d39bf3e3ec04f">calculateSatsFromAmount</a>(amount, currency);</div>
<div class="line"><span class="lineno">  580</span>        }</div>
<div class="line"><span class="lineno">  581</span>        </div>
<div class="line"><span class="lineno">  582</span>        <span class="comment">// Create the make_invoice request</span></div>
<div class="line"><span class="lineno">  583</span>        DynamicJsonDocument doc(512);</div>
<div class="line"><span class="lineno">  584</span>        doc[<span class="stringliteral">&quot;method&quot;</span>] = <span class="stringliteral">&quot;make_invoice&quot;</span>;</div>
<div class="line"><span class="lineno">  585</span>        JsonObject params = doc.createNestedObject(<span class="stringliteral">&quot;params&quot;</span>);</div>
<div class="line"><span class="lineno">  586</span>        params[<span class="stringliteral">&quot;amount&quot;</span>] = amount_sats * 1000; <span class="comment">// Convert to msats</span></div>
<div class="line"><span class="lineno">  587</span>        params[<span class="stringliteral">&quot;description&quot;</span>] = <span class="stringliteral">&quot;Payment to &quot;</span> + <a class="code hl_function" href="namespace_settings.html#a1019ae9148e79f599d5cd8f70d024853">Settings::getShopName</a>();</div>
<div class="line"><span class="lineno">  588</span>        </div>
<div class="line"><span class="lineno">  589</span>        String requestJson;</div>
<div class="line"><span class="lineno">  590</span>        serializeJson(doc, requestJson);</div>
<div class="line"><span class="lineno">  591</span>        </div>
<div class="line"><span class="lineno">  592</span>        Serial.println(<span class="stringliteral">&quot;Sending make_invoice request: &quot;</span> + requestJson);</div>
<div class="line"><span class="lineno">  593</span>        Serial.println(<span class="stringliteral">&quot;Amount: &quot;</span> + String(amount) + <span class="stringliteral">&quot; &quot;</span> + currency + <span class="stringliteral">&quot; = &quot;</span> + String(amount_sats) + <span class="stringliteral">&quot; sats&quot;</span>);</div>
<div class="line"><span class="lineno">  594</span>        </div>
<div class="line"><span class="lineno">  595</span>        <span class="comment">// Encrypt and send the request</span></div>
<div class="line"><span class="lineno">  596</span>        String encryptedDm = <a class="code hl_function" href="namespacenostr.html#a8b5b9ccf35b878cc481ed6523f568a49">nostr::getEncryptedDm</a>(nsecHexStr.c_str(), npubHexStr.c_str(), walletPubKey.c_str(), 23194, <a class="code hl_function" href="namespace_n_w_c.html#a08f91f132a611875988ba75c6d196318">getUnixTimestamp</a>(), requestJson, <span class="stringliteral">&quot;nip04&quot;</span>);</div>
<div class="line"><span class="lineno">  597</span>        webSocket.sendTXT(encryptedDm);</div>
<div class="line"><span class="lineno">  598</span>        </div>
<div class="line"><span class="lineno">  599</span>        doc.clear();</div>
<div class="line"><span class="lineno">  600</span>    }</div>
<div class="ttc" id="anamespace_n_w_c_html_a08f91f132a611875988ba75c6d196318"><div class="ttname"><a href="namespace_n_w_c.html#a08f91f132a611875988ba75c6d196318">NWC::getUnixTimestamp</a></div><div class="ttdeci">unsigned long getUnixTimestamp()</div><div class="ttdef"><b>Definition:</b> <a href="nwc_8cpp_source.html#l00830">nwc.cpp:830</a></div></div>
<div class="ttc" id="anamespace_n_w_c_html_adf733f5382e816e1e45d39bf3e3ec04f"><div class="ttname"><a href="namespace_n_w_c.html#adf733f5382e816e1e45d39bf3e3ec04f">NWC::calculateSatsFromAmount</a></div><div class="ttdeci">int calculateSatsFromAmount(float amount, const String &amp;currency)</div><div class="ttdef"><b>Definition:</b> <a href="nwc_8cpp_source.html#l00713">nwc.cpp:713</a></div></div>
<div class="ttc" id="anamespace_settings_html_a1019ae9148e79f599d5cd8f70d024853"><div class="ttname"><a href="namespace_settings.html#a1019ae9148e79f599d5cd8f70d024853">Settings::getShopName</a></div><div class="ttdeci">String getShopName()</div><div class="ttdef"><b>Definition:</b> <a href="settings_8cpp_source.html#l00067">settings.cpp:67</a></div></div>
<div class="ttc" id="anamespacenostr_html_a8b5b9ccf35b878cc481ed6523f568a49"><div class="ttname"><a href="namespacenostr.html#a8b5b9ccf35b878cc481ed6523f568a49">nostr::getEncryptedDm</a></div><div class="ttdeci">String getEncryptedDm(char const *privateKeyHex, char const *pubKeyHex, char const *recipientPubKeyHex, uint16_t kind, unsigned long timestamp, String content, String type)</div><div class="ttdoc">Get the Encrypted Dm object.</div><div class="ttdef"><b>Definition:</b> <a href="nostr_8cpp_source.html#l00467">nostr.cpp:467</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a10d04b654063bcec6d1bcf528fb3a24d" name="a10d04b654063bcec6d1bcf528fb3a24d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a10d04b654063bcec6d1bcf528fb3a24d">&#9670;&#160;</a></span>processLoop()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NWC::processLoop </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nwc_8cpp_source.html#l00849">849</a> of file <a class="el" href="nwc_8cpp_source.html">nwc.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  849</span>                       {</div>
<div class="line"><span class="lineno">  850</span>        <span class="comment">// Only process WebSocket events if WiFi is connected</span></div>
<div class="line"><span class="lineno">  851</span>        <span class="comment">// This prevents the WebSocket from blocking the main loop when there&#39;s no network</span></div>
<div class="line"><span class="lineno">  852</span>        <span class="keywordflow">if</span> (WiFi.status() == WL_CONNECTED) {</div>
<div class="line"><span class="lineno">  853</span>            <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> last_loop_time = 0;</div>
<div class="line"><span class="lineno">  854</span>            <span class="keywordflow">if</span> (millis() - last_loop_time &gt; 3000) {</div>
<div class="line"><span class="lineno">  855</span>                Serial.println(<span class="stringliteral">&quot;=== NWC loop ===&quot;</span>);</div>
<div class="line"><span class="lineno">  856</span>                Serial.println(<span class="stringliteral">&quot;Free heap: &quot;</span> + String(ESP.getFreeHeap()));</div>
<div class="line"><span class="lineno">  857</span>                last_loop_time = millis();</div>
<div class="line"><span class="lineno">  858</span>            }</div>
<div class="line"><span class="lineno">  859</span>            webSocket.loop();</div>
<div class="line"><span class="lineno">  860</span>            </div>
<div class="line"><span class="lineno">  861</span>            <span class="comment">// Check for fragment timeout</span></div>
<div class="line"><span class="lineno">  862</span>            <span class="keywordflow">if</span> (ws_fragment_in_progress &amp;&amp; (millis() - ws_fragment_start_time &gt; Config::WS_FRAGMENT_TIMEOUT)) {</div>
<div class="line"><span class="lineno">  863</span>                Serial.println(<span class="stringliteral">&quot;Fragment timeout, resetting state&quot;</span>);</div>
<div class="line"><span class="lineno">  864</span>                resetWebsocketFragmentState();</div>
<div class="line"><span class="lineno">  865</span>            }</div>
<div class="line"><span class="lineno">  866</span>            </div>
<div class="line"><span class="lineno">  867</span>            <span class="comment">// Ping handling is now done in attemptReconnectionIfNeeded()</span></div>
<div class="line"><span class="lineno">  868</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  869</span>            <span class="comment">// WiFi not connected - reset connection state to prevent hanging</span></div>
<div class="line"><span class="lineno">  870</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="ui_8cpp.html#a948b1584cfc5c1cf91af9d43729abf48">nwc_initialized</a> &amp;&amp; !connection_in_progress) {</div>
<div class="line"><span class="lineno">  871</span>                Serial.println(<span class="stringliteral">&quot;WiFi disconnected, resetting NWC connection state&quot;</span>);</div>
<div class="line"><span class="lineno">  872</span>                <a class="code hl_variable" href="ui_8cpp.html#a948b1584cfc5c1cf91af9d43729abf48">nwc_initialized</a> = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  873</span>                connection_in_progress = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  874</span>                <a class="code hl_function" href="namespace_n_w_c.html#a870035d4e450773ec8a50d0bf0b81702">resetWebsocketFragmentState</a>();</div>
<div class="line"><span class="lineno">  875</span>            }</div>
<div class="line"><span class="lineno">  876</span>        }</div>
<div class="line"><span class="lineno">  877</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a870035d4e450773ec8a50d0bf0b81702" name="a870035d4e450773ec8a50d0bf0b81702"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a870035d4e450773ec8a50d0bf0b81702">&#9670;&#160;</a></span>resetWebsocketFragmentState()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NWC::resetWebsocketFragmentState </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nwc_8cpp_source.html#l00429">429</a> of file <a class="el" href="nwc_8cpp_source.html">nwc.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  429</span>                                       {</div>
<div class="line"><span class="lineno">  430</span>        ws_fragment_in_progress = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  431</span>        ws_fragmented_message = <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line"><span class="lineno">  432</span>        ws_fragment_total_size = 0;</div>
<div class="line"><span class="lineno">  433</span>        ws_fragment_received_size = 0;</div>
<div class="line"><span class="lineno">  434</span>        ws_fragment_is_binary = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  435</span>        ws_fragment_start_time = 0;</div>
<div class="line"><span class="lineno">  436</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a342261f4ab3c85e7f89e8664b3311bf4" name="a342261f4ab3c85e7f89e8664b3311bf4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a342261f4ab3c85e7f89e8664b3311bf4">&#9670;&#160;</a></span>restartConnection()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NWC::restartConnection </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nwc_8cpp_source.html#l00229">229</a> of file <a class="el" href="nwc_8cpp_source.html">nwc.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  229</span>                             {</div>
<div class="line"><span class="lineno">  230</span>        Serial.println(<span class="stringliteral">&quot;Restarting NWC connection...&quot;</span>);</div>
<div class="line"><span class="lineno">  231</span>        webSocket.disconnect();</div>
<div class="line"><span class="lineno">  232</span>        <a class="code hl_variable" href="ui_8cpp.html#a948b1584cfc5c1cf91af9d43729abf48">nwc_initialized</a> = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  233</span>        connection_in_progress = <span class="keyword">false</span>;  <span class="comment">// Reset connection state</span></div>
<div class="line"><span class="lineno">  234</span>        </div>
<div class="line"><span class="lineno">  235</span>        <span class="keywordflow">if</span> (relayUrl.length() &gt; 0) {</div>
<div class="line"><span class="lineno">  236</span>            delay(1000);</div>
<div class="line"><span class="lineno">  237</span>            <a class="code hl_function" href="namespace_n_w_c.html#a72c06bdc692eac76bc21d4e73ce31349">connectToRelay</a>();</div>
<div class="line"><span class="lineno">  238</span>        }</div>
<div class="line"><span class="lineno">  239</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a14fff083f2b310dfa50fad5e75510d22" name="a14fff083f2b310dfa50fad5e75510d22"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a14fff083f2b310dfa50fad5e75510d22">&#9670;&#160;</a></span>saveUrlToPreferences()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NWC::saveUrlToPreferences </td>
          <td>(</td>
          <td class="paramtype">const String &amp;&#160;</td>
          <td class="paramname"><em>url</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nwc_8cpp_source.html#l00273">273</a> of file <a class="el" href="nwc_8cpp_source.html">nwc.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  273</span>                                                 {</div>
<div class="line"><span class="lineno">  274</span>        preferences.begin(<span class="stringliteral">&quot;nwc-config&quot;</span>, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno">  275</span>        preferences.putString(<span class="stringliteral">&quot;nwc_url&quot;</span>, url);</div>
<div class="line"><span class="lineno">  276</span>        preferences.end();</div>
<div class="line"><span class="lineno">  277</span>        Serial.println(<span class="stringliteral">&quot;Saved NWC URL to preferences: &quot;</span> + url);</div>
<div class="line"><span class="lineno">  278</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a86b3f2617b12ae02c2e60ea915a43076" name="a86b3f2617b12ae02c2e60ea915a43076"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a86b3f2617b12ae02c2e60ea915a43076">&#9670;&#160;</a></span>sendInvoiceLookupRequest()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NWC::sendInvoiceLookupRequest </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nwc_8cpp_source.html#l00602">602</a> of file <a class="el" href="nwc_8cpp_source.html">nwc.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  602</span>                                    {</div>
<div class="line"><span class="lineno">  603</span>        <span class="keywordflow">if</span> (!<a class="code hl_function" href="namespace_n_w_c.html#aa2e749abffc8f1f4995bb52e3a6e8f47">isConnected</a>()) {</div>
<div class="line"><span class="lineno">  604</span>            Serial.println(<span class="stringliteral">&quot;WebSocket not connected, cannot send invoice lookup&quot;</span>);</div>
<div class="line"><span class="lineno">  605</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  606</span>        }</div>
<div class="line"><span class="lineno">  607</span>        </div>
<div class="line"><span class="lineno">  608</span>        <span class="keywordflow">if</span> (current_invoice_str.isEmpty()) {</div>
<div class="line"><span class="lineno">  609</span>            Serial.println(<span class="stringliteral">&quot;No current invoice to lookup&quot;</span>);</div>
<div class="line"><span class="lineno">  610</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  611</span>        }</div>
<div class="line"><span class="lineno">  612</span>        </div>
<div class="line"><span class="lineno">  613</span>        Serial.println(<span class="stringliteral">&quot;Sending invoice lookup request for: &quot;</span> + current_invoice_str);</div>
<div class="line"><span class="lineno">  614</span>        </div>
<div class="line"><span class="lineno">  615</span>        <span class="comment">// Create the lookup_invoice request</span></div>
<div class="line"><span class="lineno">  616</span>        DynamicJsonDocument doc(512);</div>
<div class="line"><span class="lineno">  617</span>        doc[<span class="stringliteral">&quot;method&quot;</span>] = <span class="stringliteral">&quot;lookup_invoice&quot;</span>;</div>
<div class="line"><span class="lineno">  618</span>        JsonObject params = doc.createNestedObject(<span class="stringliteral">&quot;params&quot;</span>);</div>
<div class="line"><span class="lineno">  619</span>        params[<span class="stringliteral">&quot;invoice&quot;</span>] = current_invoice_str;</div>
<div class="line"><span class="lineno">  620</span>        </div>
<div class="line"><span class="lineno">  621</span>        String requestJson;</div>
<div class="line"><span class="lineno">  622</span>        serializeJson(doc, requestJson);</div>
<div class="line"><span class="lineno">  623</span>        </div>
<div class="line"><span class="lineno">  624</span>        Serial.println(<span class="stringliteral">&quot;Sending lookup_invoice request: &quot;</span> + requestJson);</div>
<div class="line"><span class="lineno">  625</span>        </div>
<div class="line"><span class="lineno">  626</span>        <span class="comment">// Encrypt and send the request</span></div>
<div class="line"><span class="lineno">  627</span>        String encryptedDm = <a class="code hl_function" href="namespacenostr.html#a8b5b9ccf35b878cc481ed6523f568a49">nostr::getEncryptedDm</a>(nsecHexStr.c_str(), npubHexStr.c_str(), walletPubKey.c_str(), 23194, <a class="code hl_function" href="namespace_n_w_c.html#a08f91f132a611875988ba75c6d196318">getUnixTimestamp</a>(), requestJson, <span class="stringliteral">&quot;nip04&quot;</span>);</div>
<div class="line"><span class="lineno">  628</span>        webSocket.sendTXT(encryptedDm);</div>
<div class="line"><span class="lineno">  629</span>        </div>
<div class="line"><span class="lineno">  630</span>        doc.clear();</div>
<div class="line"><span class="lineno">  631</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="af6a6e3b53f844f01887bfa71344c836f" name="af6a6e3b53f844f01887bfa71344c836f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af6a6e3b53f844f01887bfa71344c836f">&#9670;&#160;</a></span>sendPing()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NWC::sendPing </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nwc_8cpp_source.html#l00842">842</a> of file <a class="el" href="nwc_8cpp_source.html">nwc.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  842</span>                    {</div>
<div class="line"><span class="lineno">  843</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="namespace_n_w_c.html#aa2e749abffc8f1f4995bb52e3a6e8f47">isConnected</a>()) {</div>
<div class="line"><span class="lineno">  844</span>            webSocket.sendPing();</div>
<div class="line"><span class="lineno">  845</span>            last_ws_ping = millis();</div>
<div class="line"><span class="lineno">  846</span>        }</div>
<div class="line"><span class="lineno">  847</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a4e5666c5f59ca4d455e2148a3f06d329" name="a4e5666c5f59ca4d455e2148a3f06d329"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4e5666c5f59ca4d455e2148a3f06d329">&#9670;&#160;</a></span>setCurrentInvoice()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NWC::setCurrentInvoice </td>
          <td>(</td>
          <td class="paramtype">const String &amp;&#160;</td>
          <td class="paramname"><em>invoice</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nwc_8cpp_source.html#l00663">663</a> of file <a class="el" href="nwc_8cpp_source.html">nwc.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  663</span>                                                  {</div>
<div class="line"><span class="lineno">  664</span>        current_invoice_str = invoice;</div>
<div class="line"><span class="lineno">  665</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a66b3bd6f1962777af5011df44dcf85e7" name="a66b3bd6f1962777af5011df44dcf85e7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a66b3bd6f1962777af5011df44dcf85e7">&#9670;&#160;</a></span>setPairingUrl()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NWC::setPairingUrl </td>
          <td>(</td>
          <td class="paramtype">const String &amp;&#160;</td>
          <td class="paramname"><em>url</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nwc_8cpp_source.html#l00284">284</a> of file <a class="el" href="nwc_8cpp_source.html">nwc.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  284</span>                                          {</div>
<div class="line"><span class="lineno">  285</span>        <a class="code hl_variable" href="ui_8cpp.html#aeaf5a5f752292b6ed1aa766532cd6bc0">nwcPairingUrl</a> = url;</div>
<div class="line"><span class="lineno">  286</span>        <a class="code hl_function" href="namespace_n_w_c.html#a14fff083f2b310dfa50fad5e75510d22">saveUrlToPreferences</a>(url);</div>
<div class="line"><span class="lineno">  287</span>        <a class="code hl_function" href="namespace_n_w_c.html#a99fdb7cc9f77370099522b3461ad84ab">setupData</a>(url);</div>
<div class="line"><span class="lineno">  288</span>    }</div>
<div class="ttc" id="anamespace_n_w_c_html_a14fff083f2b310dfa50fad5e75510d22"><div class="ttname"><a href="namespace_n_w_c.html#a14fff083f2b310dfa50fad5e75510d22">NWC::saveUrlToPreferences</a></div><div class="ttdeci">void saveUrlToPreferences(const String &amp;url)</div><div class="ttdef"><b>Definition:</b> <a href="nwc_8cpp_source.html#l00273">nwc.cpp:273</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac164a3889940ecbe838a8d52cd0dd2f7" name="ac164a3889940ecbe838a8d52cd0dd2f7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac164a3889940ecbe838a8d52cd0dd2f7">&#9670;&#160;</a></span>setRelayStatusLabel()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NWC::setRelayStatusLabel </td>
          <td>(</td>
          <td class="paramtype">lv_obj_t *&#160;</td>
          <td class="paramname"><em>label</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nwc_8cpp_source.html#l00924">924</a> of file <a class="el" href="nwc_8cpp_source.html">nwc.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  924</span>                                              {</div>
<div class="line"><span class="lineno">  925</span>        relay_status_label = label;</div>
<div class="line"><span class="lineno">  926</span>        <span class="comment">// Update display with current connection state</span></div>
<div class="line"><span class="lineno">  927</span>        <a class="code hl_function" href="namespace_n_w_c.html#a28e8eb156bed73d6466b37fe3d81241d">updateRelayStatusDisplay</a>(<a class="code hl_function" href="namespace_n_w_c.html#aa2e749abffc8f1f4995bb52e3a6e8f47">isConnected</a>());</div>
<div class="line"><span class="lineno">  928</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="aa67b7139a1355f5f43c75c014796dd80" name="aa67b7139a1355f5f43c75c014796dd80"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa67b7139a1355f5f43c75c014796dd80">&#9670;&#160;</a></span>setStatusCallback()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NWC::setStatusCallback </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="namespace_n_w_c.html#a331436fb2caeba54627e342126185a74">nwc_status_callback_t</a>&#160;</td>
          <td class="paramname"><em>callback</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nwc_8cpp_source.html#l00920">920</a> of file <a class="el" href="nwc_8cpp_source.html">nwc.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  920</span>                                                           {</div>
<div class="line"><span class="lineno">  921</span>        status_callback = callback;</div>
<div class="line"><span class="lineno">  922</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a99fdb7cc9f77370099522b3461ad84ab" name="a99fdb7cc9f77370099522b3461ad84ab"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a99fdb7cc9f77370099522b3461ad84ab">&#9670;&#160;</a></span>setupData()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NWC::setupData </td>
          <td>(</td>
          <td class="paramtype">const String &amp;&#160;</td>
          <td class="paramname"><em>url</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nwc_8cpp_source.html#l00105">105</a> of file <a class="el" href="nwc_8cpp_source.html">nwc.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  105</span>                                      {</div>
<div class="line"><span class="lineno">  106</span>        <a class="code hl_variable" href="ui_8cpp.html#aeaf5a5f752292b6ed1aa766532cd6bc0">nwcPairingUrl</a> = url;</div>
<div class="line"><span class="lineno">  107</span>        </div>
<div class="line"><span class="lineno">  108</span>        <span class="comment">// Parse the NWC URL to extract relay and secret</span></div>
<div class="line"><span class="lineno">  109</span>        <span class="keywordflow">if</span> (url.startsWith(<span class="stringliteral">&quot;nostr+walletconnect://&quot;</span>)) {</div>
<div class="line"><span class="lineno">  110</span>            String urlPart = url.substring(22); <span class="comment">// Remove &quot;nostr+walletconnect://&quot;</span></div>
<div class="line"><span class="lineno">  111</span>            </div>
<div class="line"><span class="lineno">  112</span>            <span class="keywordtype">int</span> queryIndex = urlPart.indexOf(<span class="charliteral">&#39;?&#39;</span>);</div>
<div class="line"><span class="lineno">  113</span>            <span class="keywordflow">if</span> (queryIndex != -1) {</div>
<div class="line"><span class="lineno">  114</span>                walletPubKey = urlPart.substring(0, queryIndex);</div>
<div class="line"><span class="lineno">  115</span>                String queryParams = urlPart.substring(queryIndex + 1);</div>
<div class="line"><span class="lineno">  116</span>                </div>
<div class="line"><span class="lineno">  117</span>                <span class="comment">// Parse query parameters</span></div>
<div class="line"><span class="lineno">  118</span>                <span class="keywordtype">int</span> relayIndex = queryParams.indexOf(<span class="stringliteral">&quot;relay=&quot;</span>);</div>
<div class="line"><span class="lineno">  119</span>                <span class="keywordtype">int</span> secretIndex = queryParams.indexOf(<span class="stringliteral">&quot;secret=&quot;</span>);</div>
<div class="line"><span class="lineno">  120</span>                </div>
<div class="line"><span class="lineno">  121</span>                <span class="keywordflow">if</span> (relayIndex != -1) {</div>
<div class="line"><span class="lineno">  122</span>                    <span class="keywordtype">int</span> relayEnd = queryParams.indexOf(<span class="charliteral">&#39;&amp;&#39;</span>, relayIndex);</div>
<div class="line"><span class="lineno">  123</span>                    <span class="keywordflow">if</span> (relayEnd == -1) relayEnd = queryParams.length();</div>
<div class="line"><span class="lineno">  124</span>                    relayUrl = queryParams.substring(relayIndex + 6, relayEnd);</div>
<div class="line"><span class="lineno">  125</span>                    <span class="comment">// URL decode</span></div>
<div class="line"><span class="lineno">  126</span>                    relayUrl.replace(<span class="stringliteral">&quot;%3A&quot;</span>, <span class="stringliteral">&quot;:&quot;</span>);</div>
<div class="line"><span class="lineno">  127</span>                    relayUrl.replace(<span class="stringliteral">&quot;%2F&quot;</span>, <span class="stringliteral">&quot;/&quot;</span>);</div>
<div class="line"><span class="lineno">  128</span>                }</div>
<div class="line"><span class="lineno">  129</span>                </div>
<div class="line"><span class="lineno">  130</span>                <span class="keywordflow">if</span> (secretIndex != -1) {</div>
<div class="line"><span class="lineno">  131</span>                    <span class="keywordtype">int</span> secretEnd = queryParams.indexOf(<span class="charliteral">&#39;&amp;&#39;</span>, secretIndex);</div>
<div class="line"><span class="lineno">  132</span>                    <span class="keywordflow">if</span> (secretEnd == -1) secretEnd = queryParams.length();</div>
<div class="line"><span class="lineno">  133</span>                    nsecHexStr = queryParams.substring(secretIndex + 7, secretEnd);</div>
<div class="line"><span class="lineno">  134</span>                }</div>
<div class="line"><span class="lineno">  135</span>            }</div>
<div class="line"><span class="lineno">  136</span>        }</div>
<div class="line"><span class="lineno">  137</span>        </div>
<div class="line"><span class="lineno">  138</span>        Serial.println(<span class="stringliteral">&quot;NWC Data Setup:&quot;</span>);</div>
<div class="line"><span class="lineno">  139</span>        Serial.println(<span class="stringliteral">&quot;Wallet PubKey: &quot;</span> + walletPubKey);</div>
<div class="line"><span class="lineno">  140</span>        Serial.println(<span class="stringliteral">&quot;Relay URL: &quot;</span> + relayUrl);</div>
<div class="line"><span class="lineno">  141</span>        Serial.println(<span class="stringliteral">&quot;Secret: &quot;</span> + nsecHexStr);</div>
<div class="line"><span class="lineno">  142</span>        </div>
<div class="line"><span class="lineno">  143</span>        <span class="comment">// Generate npub from nsec if needed</span></div>
<div class="line"><span class="lineno">  144</span>        <span class="keywordflow">if</span> (nsecHexStr.length() &gt; 0) {</div>
<div class="line"><span class="lineno">  145</span>            <span class="keywordtype">int</span> byteSize = 32;</div>
<div class="line"><span class="lineno">  146</span>            <span class="keywordtype">byte</span> privateKeyBytes[byteSize];</div>
<div class="line"><span class="lineno">  147</span>            fromHex(nsecHexStr.c_str(), privateKeyBytes, byteSize);</div>
<div class="line"><span class="lineno">  148</span> </div>
<div class="line"><span class="lineno">  149</span>            PrivateKey privateKey(privateKeyBytes);</div>
<div class="line"><span class="lineno">  150</span>            PublicKey pub = privateKey.publicKey();</div>
<div class="line"><span class="lineno">  151</span>    </div>
<div class="line"><span class="lineno">  152</span>            <span class="comment">// Extract only the X coordinate (32 bytes) for Nostr</span></div>
<div class="line"><span class="lineno">  153</span>            <span class="keywordtype">byte</span> pubKeyBytes[33];</div>
<div class="line"><span class="lineno">  154</span>            pub.serialize(pubKeyBytes, <span class="keyword">sizeof</span>(pubKeyBytes));</div>
<div class="line"><span class="lineno">  155</span>            </div>
<div class="line"><span class="lineno">  156</span>            <span class="comment">// Convert the X coordinate (bytes 1-32) to hex string</span></div>
<div class="line"><span class="lineno">  157</span>            <span class="keywordtype">char</span> npubHex[65];</div>
<div class="line"><span class="lineno">  158</span>            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 1; i &lt; 33; i++) {</div>
<div class="line"><span class="lineno">  159</span>                sprintf(npubHex + (i-1)*2, <span class="stringliteral">&quot;%02x&quot;</span>, pubKeyBytes[i]);</div>
<div class="line"><span class="lineno">  160</span>            }</div>
<div class="line"><span class="lineno">  161</span>            npubHex[64] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">  162</span>            npubHexStr = String(npubHex);</div>
<div class="line"><span class="lineno">  163</span>            <a class="code hl_function" href="namespace_n_w_c.html#a14fff083f2b310dfa50fad5e75510d22">saveUrlToPreferences</a>(url);</div>
<div class="line"><span class="lineno">  164</span>        }</div>
<div class="line"><span class="lineno">  165</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a1c4b50b7a22b309f6b6f3ddcf9f32a74" name="a1c4b50b7a22b309f6b6f3ddcf9f32a74"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1c4b50b7a22b309f6b6f3ddcf9f32a74">&#9670;&#160;</a></span>startInvoiceLookupTimer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NWC::startInvoiceLookupTimer </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nwc_8cpp_source.html#l00646">646</a> of file <a class="el" href="nwc_8cpp_source.html">nwc.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  646</span>                                   {</div>
<div class="line"><span class="lineno">  647</span>        <span class="keywordflow">if</span> (invoice_lookup_timer == NULL) {</div>
<div class="line"><span class="lineno">  648</span>            invoice_lookup_timer = lv_timer_create(invoiceLookupTimerCallback, 3000, NULL); <span class="comment">// 3 seconds</span></div>
<div class="line"><span class="lineno">  649</span>        }</div>
<div class="line"><span class="lineno">  650</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a209d5a499b7718c1a0d5984a191091a9" name="a209d5a499b7718c1a0d5984a191091a9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a209d5a499b7718c1a0d5984a191091a9">&#9670;&#160;</a></span>startInvoiceNotificationWatchdog()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NWC::startInvoiceNotificationWatchdog </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nwc_8cpp_source.html#l00633">633</a> of file <a class="el" href="nwc_8cpp_source.html">nwc.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  633</span>                                            {</div>
<div class="line"><span class="lineno">  634</span>        <span class="keywordflow">if</span> (invoice_notification_watchdog_timer == NULL) {</div>
<div class="line"><span class="lineno">  635</span>            invoice_notification_watchdog_timer = lv_timer_create(invoiceNotificationWatchdogCallback, 30000, NULL);</div>
<div class="line"><span class="lineno">  636</span>        }</div>
<div class="line"><span class="lineno">  637</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a1dd636b9104cd24b5d2fbd91329a67cd" name="a1dd636b9104cd24b5d2fbd91329a67cd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1dd636b9104cd24b5d2fbd91329a67cd">&#9670;&#160;</a></span>stopInvoiceLookupTimer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NWC::stopInvoiceLookupTimer </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nwc_8cpp_source.html#l00652">652</a> of file <a class="el" href="nwc_8cpp_source.html">nwc.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  652</span>                                  {</div>
<div class="line"><span class="lineno">  653</span>        <span class="keywordflow">if</span> (invoice_lookup_timer) {</div>
<div class="line"><span class="lineno">  654</span>            lv_timer_del(invoice_lookup_timer);</div>
<div class="line"><span class="lineno">  655</span>            invoice_lookup_timer = NULL;</div>
<div class="line"><span class="lineno">  656</span>        }</div>
<div class="line"><span class="lineno">  657</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a9a72ecf2c1ad80aafcb1d1a79651d0aa" name="a9a72ecf2c1ad80aafcb1d1a79651d0aa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9a72ecf2c1ad80aafcb1d1a79651d0aa">&#9670;&#160;</a></span>stopInvoiceNotificationWatchdog()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NWC::stopInvoiceNotificationWatchdog </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nwc_8cpp_source.html#l00639">639</a> of file <a class="el" href="nwc_8cpp_source.html">nwc.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  639</span>                                           {</div>
<div class="line"><span class="lineno">  640</span>        <span class="keywordflow">if</span> (invoice_notification_watchdog_timer) {</div>
<div class="line"><span class="lineno">  641</span>            lv_timer_del(invoice_notification_watchdog_timer);</div>
<div class="line"><span class="lineno">  642</span>            invoice_notification_watchdog_timer = NULL;</div>
<div class="line"><span class="lineno">  643</span>        }</div>
<div class="line"><span class="lineno">  644</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a6084bca944be2b2f16e57728dbbc64dc" name="a6084bca944be2b2f16e57728dbbc64dc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6084bca944be2b2f16e57728dbbc64dc">&#9670;&#160;</a></span>updatePricesFromJson()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NWC::updatePricesFromJson </td>
          <td>(</td>
          <td class="paramtype">const String &amp;&#160;</td>
          <td class="paramname"><em>jsonResponse</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nwc_8cpp_source.html#l00690">690</a> of file <a class="el" href="nwc_8cpp_source.html">nwc.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  690</span>                                                          {</div>
<div class="line"><span class="lineno">  691</span>        DynamicJsonDocument doc(2048);</div>
<div class="line"><span class="lineno">  692</span>        DeserializationError error = deserializeJson(doc, jsonResponse);</div>
<div class="line"><span class="lineno">  693</span>        </div>
<div class="line"><span class="lineno">  694</span>        <span class="keywordflow">if</span> (error) {</div>
<div class="line"><span class="lineno">  695</span>            Serial.println(<span class="stringliteral">&quot;Failed to parse price JSON&quot;</span>);</div>
<div class="line"><span class="lineno">  696</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  697</span>        }</div>
<div class="line"><span class="lineno">  698</span>        </div>
<div class="line"><span class="lineno">  699</span>        <span class="comment">// Update price array</span></div>
<div class="line"><span class="lineno">  700</span>        btc_prices[Currency::USD] = doc[<span class="stringliteral">&quot;USD&quot;</span>].as&lt;<span class="keywordtype">long</span>&gt;();</div>
<div class="line"><span class="lineno">  701</span>        btc_prices[Currency::EUR] = doc[<span class="stringliteral">&quot;EUR&quot;</span>].as&lt;<span class="keywordtype">long</span>&gt;();</div>
<div class="line"><span class="lineno">  702</span>        btc_prices[Currency::GBP] = doc[<span class="stringliteral">&quot;GBP&quot;</span>].as&lt;<span class="keywordtype">long</span>&gt;();</div>
<div class="line"><span class="lineno">  703</span>        btc_prices[Currency::CAD] = doc[<span class="stringliteral">&quot;CAD&quot;</span>].as&lt;<span class="keywordtype">long</span>&gt;();</div>
<div class="line"><span class="lineno">  704</span>        btc_prices[Currency::CHF] = doc[<span class="stringliteral">&quot;CHF&quot;</span>].as&lt;<span class="keywordtype">long</span>&gt;();</div>
<div class="line"><span class="lineno">  705</span>        btc_prices[Currency::AUD] = doc[<span class="stringliteral">&quot;AUD&quot;</span>].as&lt;<span class="keywordtype">long</span>&gt;();</div>
<div class="line"><span class="lineno">  706</span>        btc_prices[Currency::JPY] = doc[<span class="stringliteral">&quot;JPY&quot;</span>].as&lt;<span class="keywordtype">long</span>&gt;();</div>
<div class="line"><span class="lineno">  707</span>        btc_prices[Currency::CNY] = doc[<span class="stringliteral">&quot;CNY&quot;</span>].as&lt;<span class="keywordtype">long</span>&gt;();</div>
<div class="line"><span class="lineno">  708</span>        </div>
<div class="line"><span class="lineno">  709</span>        Serial.printf(<span class="stringliteral">&quot;Updated prices - USD: %ld, EUR: %ld, GBP: %ld\\n&quot;</span>, </div>
<div class="line"><span class="lineno">  710</span>                     btc_prices[Currency::USD], btc_prices[Currency::EUR], btc_prices[Currency::GBP]);</div>
<div class="line"><span class="lineno">  711</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a28e8eb156bed73d6466b37fe3d81241d" name="a28e8eb156bed73d6466b37fe3d81241d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a28e8eb156bed73d6466b37fe3d81241d">&#9670;&#160;</a></span>updateRelayStatusDisplay()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NWC::updateRelayStatusDisplay </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>connected</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nwc_8cpp_source.html#l00802">802</a> of file <a class="el" href="nwc_8cpp_source.html">nwc.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  802</span>                                                  {</div>
<div class="line"><span class="lineno">  803</span>        <span class="keywordflow">if</span> (status_callback) {</div>
<div class="line"><span class="lineno">  804</span>            status_callback(connected, connected ? <span class="stringliteral">&quot;Relay Connected&quot;</span> : <span class="stringliteral">&quot;Relay Disconnected&quot;</span>);</div>
<div class="line"><span class="lineno">  805</span>        }</div>
<div class="line"><span class="lineno">  806</span>        </div>
<div class="line"><span class="lineno">  807</span>        <span class="comment">// Update the relay status label</span></div>
<div class="line"><span class="lineno">  808</span>        <span class="keywordflow">if</span> (relay_status_label != NULL &amp;&amp; lv_obj_is_valid(relay_status_label)) {</div>
<div class="line"><span class="lineno">  809</span>            <span class="keywordflow">if</span> (connected) {</div>
<div class="line"><span class="lineno">  810</span>                String relay_status_text = LV_SYMBOL_OK + String(<span class="stringliteral">&quot; Relay: Connected&quot;</span>);</div>
<div class="line"><span class="lineno">  811</span>                lv_label_set_text(relay_status_label, relay_status_text.c_str());</div>
<div class="line"><span class="lineno">  812</span>                lv_obj_set_style_text_color(relay_status_label, lv_color_hex(0x00FF00), 0);</div>
<div class="line"><span class="lineno">  813</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  814</span>                String relay_status_text = <span class="stringliteral">&quot;Relay: Disconnected&quot;</span>;</div>
<div class="line"><span class="lineno">  815</span>                lv_label_set_text(relay_status_label, relay_status_text.c_str());</div>
<div class="line"><span class="lineno">  816</span>                lv_obj_set_style_text_color(relay_status_label, lv_color_hex(0x9E9E9E), 0);</div>
<div class="line"><span class="lineno">  817</span>            }</div>
<div class="line"><span class="lineno">  818</span>        }</div>
<div class="line"><span class="lineno">  819</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="acd1483629fef32437ab3d58cbfe11318" name="acd1483629fef32437ab3d58cbfe11318"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acd1483629fef32437ab3d58cbfe11318">&#9670;&#160;</a></span>updateTime()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NWC::updateTime </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nwc_8cpp_source.html#l00821">821</a> of file <a class="el" href="nwc_8cpp_source.html">nwc.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  821</span>                      {</div>
<div class="line"><span class="lineno">  822</span>        <span class="comment">// Only update time from NTP server if WiFi is connected</span></div>
<div class="line"><span class="lineno">  823</span>        <span class="comment">// This prevents DNS resolution failures when there&#39;s no network</span></div>
<div class="line"><span class="lineno">  824</span>        <span class="keywordflow">if</span> (WiFi.status() == WL_CONNECTED) {</div>
<div class="line"><span class="lineno">  825</span>            timeClient.update();</div>
<div class="line"><span class="lineno">  826</span>        }</div>
<div class="line"><span class="lineno">  827</span>        unixTimestamp = timeClient.getEpochTime();</div>
<div class="line"><span class="lineno">  828</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="aa137fc6f2c6092d4b9464c4246e851c6" name="aa137fc6f2c6092d4b9464c4246e851c6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa137fc6f2c6092d4b9464c4246e851c6">&#9670;&#160;</a></span>websocketEvent()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NWC::websocketEvent </td>
          <td>(</td>
          <td class="paramtype">WStype_t&#160;</td>
          <td class="paramname"><em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>payload</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>length</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nwc_8cpp_source.html#l00290">290</a> of file <a class="el" href="nwc_8cpp_source.html">nwc.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  290</span>                                                                        {</div>
<div class="line"><span class="lineno">  291</span>        <span class="keywordflow">switch</span> (type) {</div>
<div class="line"><span class="lineno">  292</span>            <span class="keywordflow">case</span> WStype_DISCONNECTED:</div>
<div class="line"><span class="lineno">  293</span>                Serial.printf(<span class="stringliteral">&quot;[WSc] Disconnected!\\n&quot;</span>);</div>
<div class="line"><span class="lineno">  294</span>                <a class="code hl_variable" href="ui_8cpp.html#a948b1584cfc5c1cf91af9d43729abf48">nwc_initialized</a> = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  295</span>                connection_in_progress = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  296</span>                <a class="code hl_function" href="namespace_n_w_c.html#a870035d4e450773ec8a50d0bf0b81702">resetWebsocketFragmentState</a>();</div>
<div class="line"><span class="lineno">  297</span>                <a class="code hl_function" href="namespace_n_w_c.html#a28e8eb156bed73d6466b37fe3d81241d">updateRelayStatusDisplay</a>(<span class="keyword">false</span>);</div>
<div class="line"><span class="lineno">  298</span>                <span class="keywordflow">if</span> (status_callback) {</div>
<div class="line"><span class="lineno">  299</span>                    status_callback(<span class="keyword">false</span>, <span class="stringliteral">&quot;Disconnected&quot;</span>);</div>
<div class="line"><span class="lineno">  300</span>                }</div>
<div class="line"><span class="lineno">  301</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  302</span>                </div>
<div class="line"><span class="lineno">  303</span>            <span class="keywordflow">case</span> WStype_CONNECTED:</div>
<div class="line"><span class="lineno">  304</span>                Serial.printf(<span class="stringliteral">&quot;[WSc] Connected to: %s\\n&quot;</span>, payload);</div>
<div class="line"><span class="lineno">  305</span>                <a class="code hl_variable" href="ui_8cpp.html#a948b1584cfc5c1cf91af9d43729abf48">nwc_initialized</a> = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  306</span>                connection_in_progress = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  307</span>                last_ws_ping = millis();</div>
<div class="line"><span class="lineno">  308</span>                last_ws_message_received = millis();</div>
<div class="line"><span class="lineno">  309</span>                reconnection_attempts = 0; <span class="comment">// Reset reconnection counter on successful connection</span></div>
<div class="line"><span class="lineno">  310</span>                updateRelayStatusDisplay(<span class="keyword">true</span>);</div>
<div class="line"><span class="lineno">  311</span>                <span class="keywordflow">if</span> (status_callback) {</div>
<div class="line"><span class="lineno">  312</span>                    status_callback(<span class="keyword">true</span>, <span class="stringliteral">&quot;Connected&quot;</span>);</div>
<div class="line"><span class="lineno">  313</span>                }</div>
<div class="line"><span class="lineno">  314</span>                </div>
<div class="line"><span class="lineno">  315</span>                <span class="comment">// Subscribe to events</span></div>
<div class="line"><span class="lineno">  316</span>                {</div>
<div class="line"><span class="lineno">  317</span>                    String subscriptionId = <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line"><span class="lineno">  318</span>                    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 16; i++) {</div>
<div class="line"><span class="lineno">  319</span>                        subscriptionId += String(random(16), HEX);</div>
<div class="line"><span class="lineno">  320</span>                    }</div>
<div class="line"><span class="lineno">  321</span>                    </div>
<div class="line"><span class="lineno">  322</span>                    String subscribeMessage = <span class="stringliteral">&quot;[\&quot;REQ\&quot;,\&quot;&quot;</span> + subscriptionId + <span class="stringliteral">&quot;\&quot;,{\&quot;kinds\&quot;:[23195,23196,23197],\&quot;#p\&quot;:[\&quot;&quot;</span> + npubHexStr + <span class="stringliteral">&quot;\&quot;]}]&quot;</span>;</div>
<div class="line"><span class="lineno">  323</span>                    webSocket.sendTXT(subscribeMessage);</div>
<div class="line"><span class="lineno">  324</span>                    Serial.println(<span class="stringliteral">&quot;Sent subscription: &quot;</span> + subscribeMessage);</div>
<div class="line"><span class="lineno">  325</span>                }</div>
<div class="line"><span class="lineno">  326</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  327</span>                </div>
<div class="line"><span class="lineno">  328</span>            <span class="keywordflow">case</span> WStype_TEXT:</div>
<div class="line"><span class="lineno">  329</span>                Serial.printf(<span class="stringliteral">&quot;[WSc] Received text: %s\\n&quot;</span>, payload);</div>
<div class="line"><span class="lineno">  330</span>                last_ws_message_received = millis(); <span class="comment">// Track message reception</span></div>
<div class="line"><span class="lineno">  331</span>                <a class="code hl_function" href="namespace_n_w_c.html#a18f2ad2c95003389637ea9d84d18d5cf">handleWebsocketMessage</a>(NULL, payload, length);</div>
<div class="line"><span class="lineno">  332</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  333</span>                </div>
<div class="line"><span class="lineno">  334</span>            <span class="keywordflow">case</span> WStype_BIN:</div>
<div class="line"><span class="lineno">  335</span>                last_ws_message_received = millis(); <span class="comment">// Track binary message reception</span></div>
<div class="line"><span class="lineno">  336</span>                Serial.printf(<span class="stringliteral">&quot;[WSc] Received binary length: %u\\n&quot;</span>, length);</div>
<div class="line"><span class="lineno">  337</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  338</span>                </div>
<div class="line"><span class="lineno">  339</span>            <span class="keywordflow">case</span> WStype_FRAGMENT_TEXT_START:</div>
<div class="line"><span class="lineno">  340</span>                Serial.printf(<span class="stringliteral">&quot;[WSc] Fragment text start, length: %u\\n&quot;</span>, length);</div>
<div class="line"><span class="lineno">  341</span>                ws_fragment_in_progress = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  342</span>                ws_fragment_is_binary = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  343</span>                ws_fragmented_message = String((<span class="keywordtype">char</span>*)payload);</div>
<div class="line"><span class="lineno">  344</span>                ws_fragment_start_time = millis();</div>
<div class="line"><span class="lineno">  345</span>                ws_fragment_received_size = length;</div>
<div class="line"><span class="lineno">  346</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  347</span>                </div>
<div class="line"><span class="lineno">  348</span>            <span class="keywordflow">case</span> WStype_FRAGMENT_BIN_START:</div>
<div class="line"><span class="lineno">  349</span>                Serial.printf(<span class="stringliteral">&quot;[WSc] Fragment binary start, length: %u\\n&quot;</span>, length);</div>
<div class="line"><span class="lineno">  350</span>                ws_fragment_in_progress = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  351</span>                ws_fragment_is_binary = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  352</span>                ws_fragment_start_time = millis();</div>
<div class="line"><span class="lineno">  353</span>                ws_fragment_received_size = length;</div>
<div class="line"><span class="lineno">  354</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  355</span>                </div>
<div class="line"><span class="lineno">  356</span>            <span class="keywordflow">case</span> WStype_FRAGMENT:</div>
<div class="line"><span class="lineno">  357</span>                <span class="keywordflow">if</span> (ws_fragment_in_progress) {</div>
<div class="line"><span class="lineno">  358</span>                    ws_fragment_received_size += length;</div>
<div class="line"><span class="lineno">  359</span>                    <span class="keywordflow">if</span> (!ws_fragment_is_binary) {</div>
<div class="line"><span class="lineno">  360</span>                        ws_fragmented_message += String((<span class="keywordtype">char</span>*)payload);</div>
<div class="line"><span class="lineno">  361</span>                    }</div>
<div class="line"><span class="lineno">  362</span>                    Serial.printf(<span class="stringliteral">&quot;[WSc] Fragment received, total size: %u\\n&quot;</span>, ws_fragment_received_size);</div>
<div class="line"><span class="lineno">  363</span>                }</div>
<div class="line"><span class="lineno">  364</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  365</span>                </div>
<div class="line"><span class="lineno">  366</span>            <span class="keywordflow">case</span> WStype_FRAGMENT_FIN:</div>
<div class="line"><span class="lineno">  367</span>                <span class="keywordflow">if</span> (ws_fragment_in_progress) {</div>
<div class="line"><span class="lineno">  368</span>                    ws_fragment_received_size += length;</div>
<div class="line"><span class="lineno">  369</span>                    <span class="keywordflow">if</span> (!ws_fragment_is_binary) {</div>
<div class="line"><span class="lineno">  370</span>                        ws_fragmented_message += String((<span class="keywordtype">char</span>*)payload);</div>
<div class="line"><span class="lineno">  371</span>                        Serial.printf(<span class="stringliteral">&quot;[WSc] Fragment finished, final message: %s\\n&quot;</span>, ws_fragmented_message.c_str());</div>
<div class="line"><span class="lineno">  372</span>                        <a class="code hl_function" href="namespace_n_w_c.html#a18f2ad2c95003389637ea9d84d18d5cf">handleWebsocketMessage</a>(NULL, (uint8_t*)ws_fragmented_message.c_str(), ws_fragmented_message.length());</div>
<div class="line"><span class="lineno">  373</span>                    }</div>
<div class="line"><span class="lineno">  374</span>                    <a class="code hl_function" href="namespace_n_w_c.html#a870035d4e450773ec8a50d0bf0b81702">resetWebsocketFragmentState</a>();</div>
<div class="line"><span class="lineno">  375</span>                }</div>
<div class="line"><span class="lineno">  376</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  377</span>                </div>
<div class="line"><span class="lineno">  378</span>            <span class="keywordflow">case</span> WStype_ERROR:</div>
<div class="line"><span class="lineno">  379</span>                Serial.printf(<span class="stringliteral">&quot;[WSc] Error: %s\\n&quot;</span>, payload);</div>
<div class="line"><span class="lineno">  380</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  381</span>                </div>
<div class="line"><span class="lineno">  382</span>            <span class="keywordflow">case</span> WStype_PONG:</div>
<div class="line"><span class="lineno">  383</span>                Serial.printf(<span class="stringliteral">&quot;[WSc] Pong received\\n&quot;</span>);</div>
<div class="line"><span class="lineno">  384</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  385</span>                </div>
<div class="line"><span class="lineno">  386</span>            <span class="keywordflow">default</span>:</div>
<div class="line"><span class="lineno">  387</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  388</span>        }</div>
<div class="line"><span class="lineno">  389</span>    }</div>
<div class="ttc" id="anamespace_n_w_c_html_a18f2ad2c95003389637ea9d84d18d5cf"><div class="ttname"><a href="namespace_n_w_c.html#a18f2ad2c95003389637ea9d84d18d5cf">NWC::handleWebsocketMessage</a></div><div class="ttdeci">void handleWebsocketMessage(void *arg, uint8_t *data, size_t len)</div><div class="ttdef"><b>Definition:</b> <a href="nwc_8cpp_source.html#l00391">nwc.cpp:391</a></div></div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespace_n_w_c.html">NWC</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6 </li>
  </ul>
</div>
</body>
</html>
