\hypertarget{main_8cpp}{}\doxysection{src/main.cpp File Reference}
\label{main_8cpp}\index{src/main.cpp@{src/main.cpp}}


NWC Powered Point of Sale Device -\/ Main Entry Point.  


{\ttfamily \#include $<$Arduino.\+h$>$}\newline
{\ttfamily \#include $<$lvgl.\+h$>$}\newline
{\ttfamily \#include $<$Wi\+Fi.\+h$>$}\newline
{\ttfamily \#include $<$Preferences.\+h$>$}\newline
{\ttfamily \#include \char`\"{}freertos/\+Free\+RTOS.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}freertos/task.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}freertos/queue.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}app.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}../lib/nostr/nostr.\+h\char`\"{}}\newline
Include dependency graph for main.\+cpp\+:
% FIG 0
\doxysubsection*{Classes}
\begin{DoxyCompactItemize}
\item 
struct \mbox{\hyperlink{structwifi__command__t}{wifi\+\_\+command\+\_\+t}}
\item 
struct \mbox{\hyperlink{structwifi__scan__result__t}{wifi\+\_\+scan\+\_\+result\+\_\+t}}
\end{DoxyCompactItemize}
\doxysubsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \mbox{\hyperlink{main_8cpp_ab8338d33d592df45a77857c81340ed51}{EVENT\+\_\+\+NOTE\+\_\+\+SIZE}}~2000000
\item 
\#define \mbox{\hyperlink{main_8cpp_a8ea9ad716a8cc63afacef39f4534c56a}{ENCRYPTED\+\_\+\+MESSAGE\+\_\+\+BIN\+\_\+\+SIZE}}~100000
\end{DoxyCompactItemize}
\doxysubsection*{Enumerations}
\begin{DoxyCompactItemize}
\item 
enum \mbox{\hyperlink{main_8cpp_a39e9cd7b432e4f3e6b935985bddf2a0c}{wifi\+\_\+command\+\_\+type\+\_\+t}} \{ \mbox{\hyperlink{main_8cpp_a39e9cd7b432e4f3e6b935985bddf2a0cabc79e21d660ad53ddb48f80412b26363}{WIFI\+\_\+\+SCAN}}
, \mbox{\hyperlink{main_8cpp_a39e9cd7b432e4f3e6b935985bddf2a0caf14ac08f8d7b221cd1e510207f041224}{WIFI\+\_\+\+CONNECT}}
, \mbox{\hyperlink{main_8cpp_a39e9cd7b432e4f3e6b935985bddf2a0cae98478e31cd6b9f5453c009e650afd62}{WIFI\+\_\+\+DISCONNECT}}
, \mbox{\hyperlink{main_8cpp_a39e9cd7b432e4f3e6b935985bddf2a0ca830823a0d1d8d9b5d7fcf516f10a396c}{WIFI\+\_\+\+STOP\+\_\+\+SCAN}}
 \}
\end{DoxyCompactItemize}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{main_8cpp_a7dfd9b79bc5a37d7df40207afbc5431f}{setup}} (void)
\item 
void \mbox{\hyperlink{main_8cpp_a0b33edabd7f1c4e4a0bf32c67269be2f}{loop}} (void)
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
NWC Powered Point of Sale Device -\/ Main Entry Point. 

Modular ESP32 Point of Sale system featuring\+:
\begin{DoxyItemize}
\item Touch screen interface
\item Wi\+Fi connectivity with AP mode setup
\item Nostr Wallet Connect integration for Lightning payments
\item LVGL-\/based user interface with QR code generation
\item Deep sleep power management
\end{DoxyItemize}

\begin{DoxyAuthor}{Author}
Black\+Coffee \href{mailto:bc@lnbits.com}{\texttt{ bc@lnbits.\+com}} 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
1.\+0.\+0 
\end{DoxyVersion}
\begin{DoxyDate}{Date}
07-\/2025 
\end{DoxyDate}


Definition in file \mbox{\hyperlink{main_8cpp_source}{main.\+cpp}}.



\doxysubsection{Macro Definition Documentation}
\mbox{\Hypertarget{main_8cpp_a8ea9ad716a8cc63afacef39f4534c56a}\label{main_8cpp_a8ea9ad716a8cc63afacef39f4534c56a}} 
\index{main.cpp@{main.cpp}!ENCRYPTED\_MESSAGE\_BIN\_SIZE@{ENCRYPTED\_MESSAGE\_BIN\_SIZE}}
\index{ENCRYPTED\_MESSAGE\_BIN\_SIZE@{ENCRYPTED\_MESSAGE\_BIN\_SIZE}!main.cpp@{main.cpp}}
\doxysubsubsection{\texorpdfstring{ENCRYPTED\_MESSAGE\_BIN\_SIZE}{ENCRYPTED\_MESSAGE\_BIN\_SIZE}}
{\footnotesize\ttfamily \#define ENCRYPTED\+\_\+\+MESSAGE\+\_\+\+BIN\+\_\+\+SIZE~100000}



Definition at line \mbox{\hyperlink{main_8cpp_source_l00034}{34}} of file \mbox{\hyperlink{main_8cpp_source}{main.\+cpp}}.

\mbox{\Hypertarget{main_8cpp_ab8338d33d592df45a77857c81340ed51}\label{main_8cpp_ab8338d33d592df45a77857c81340ed51}} 
\index{main.cpp@{main.cpp}!EVENT\_NOTE\_SIZE@{EVENT\_NOTE\_SIZE}}
\index{EVENT\_NOTE\_SIZE@{EVENT\_NOTE\_SIZE}!main.cpp@{main.cpp}}
\doxysubsubsection{\texorpdfstring{EVENT\_NOTE\_SIZE}{EVENT\_NOTE\_SIZE}}
{\footnotesize\ttfamily \#define EVENT\+\_\+\+NOTE\+\_\+\+SIZE~2000000}



Definition at line \mbox{\hyperlink{main_8cpp_source_l00033}{33}} of file \mbox{\hyperlink{main_8cpp_source}{main.\+cpp}}.



\doxysubsection{Enumeration Type Documentation}
\mbox{\Hypertarget{main_8cpp_a39e9cd7b432e4f3e6b935985bddf2a0c}\label{main_8cpp_a39e9cd7b432e4f3e6b935985bddf2a0c}} 
\index{main.cpp@{main.cpp}!wifi\_command\_type\_t@{wifi\_command\_type\_t}}
\index{wifi\_command\_type\_t@{wifi\_command\_type\_t}!main.cpp@{main.cpp}}
\doxysubsubsection{\texorpdfstring{wifi\_command\_type\_t}{wifi\_command\_type\_t}}
{\footnotesize\ttfamily enum \mbox{\hyperlink{main_8cpp_a39e9cd7b432e4f3e6b935985bddf2a0c}{wifi\+\_\+command\+\_\+type\+\_\+t}}}

\begin{DoxyEnumFields}{Enumerator}
\raisebox{\heightof{T}}[0pt][0pt]{\index{WIFI\_SCAN@{WIFI\_SCAN}!main.cpp@{main.cpp}}\index{main.cpp@{main.cpp}!WIFI\_SCAN@{WIFI\_SCAN}}}\mbox{\Hypertarget{main_8cpp_a39e9cd7b432e4f3e6b935985bddf2a0cabc79e21d660ad53ddb48f80412b26363}\label{main_8cpp_a39e9cd7b432e4f3e6b935985bddf2a0cabc79e21d660ad53ddb48f80412b26363}} 
WIFI\+\_\+\+SCAN&\\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{WIFI\_CONNECT@{WIFI\_CONNECT}!main.cpp@{main.cpp}}\index{main.cpp@{main.cpp}!WIFI\_CONNECT@{WIFI\_CONNECT}}}\mbox{\Hypertarget{main_8cpp_a39e9cd7b432e4f3e6b935985bddf2a0caf14ac08f8d7b221cd1e510207f041224}\label{main_8cpp_a39e9cd7b432e4f3e6b935985bddf2a0caf14ac08f8d7b221cd1e510207f041224}} 
WIFI\+\_\+\+CONNECT&\\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{WIFI\_DISCONNECT@{WIFI\_DISCONNECT}!main.cpp@{main.cpp}}\index{main.cpp@{main.cpp}!WIFI\_DISCONNECT@{WIFI\_DISCONNECT}}}\mbox{\Hypertarget{main_8cpp_a39e9cd7b432e4f3e6b935985bddf2a0cae98478e31cd6b9f5453c009e650afd62}\label{main_8cpp_a39e9cd7b432e4f3e6b935985bddf2a0cae98478e31cd6b9f5453c009e650afd62}} 
WIFI\+\_\+\+DISCONNECT&\\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{WIFI\_STOP\_SCAN@{WIFI\_STOP\_SCAN}!main.cpp@{main.cpp}}\index{main.cpp@{main.cpp}!WIFI\_STOP\_SCAN@{WIFI\_STOP\_SCAN}}}\mbox{\Hypertarget{main_8cpp_a39e9cd7b432e4f3e6b935985bddf2a0ca830823a0d1d8d9b5d7fcf516f10a396c}\label{main_8cpp_a39e9cd7b432e4f3e6b935985bddf2a0ca830823a0d1d8d9b5d7fcf516f10a396c}} 
WIFI\+\_\+\+STOP\+\_\+\+SCAN&\\
\hline

\end{DoxyEnumFields}


Definition at line \mbox{\hyperlink{main_8cpp_source_l00044}{44}} of file \mbox{\hyperlink{main_8cpp_source}{main.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00044\ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00045\ \ \ \ \ \mbox{\hyperlink{main_8cpp_a39e9cd7b432e4f3e6b935985bddf2a0cabc79e21d660ad53ddb48f80412b26363}{WIFI\_SCAN}},}
\DoxyCodeLine{00046\ \ \ \ \ \mbox{\hyperlink{main_8cpp_a39e9cd7b432e4f3e6b935985bddf2a0caf14ac08f8d7b221cd1e510207f041224}{WIFI\_CONNECT}},}
\DoxyCodeLine{00047\ \ \ \ \ \mbox{\hyperlink{main_8cpp_a39e9cd7b432e4f3e6b935985bddf2a0cae98478e31cd6b9f5453c009e650afd62}{WIFI\_DISCONNECT}},}
\DoxyCodeLine{00048\ \ \ \ \ \mbox{\hyperlink{main_8cpp_a39e9cd7b432e4f3e6b935985bddf2a0ca830823a0d1d8d9b5d7fcf516f10a396c}{WIFI\_STOP\_SCAN}}}
\DoxyCodeLine{00049\ \}\ \mbox{\hyperlink{main_8cpp_a39e9cd7b432e4f3e6b935985bddf2a0c}{wifi\_command\_type\_t}};}

\end{DoxyCode}


\doxysubsection{Function Documentation}
\mbox{\Hypertarget{main_8cpp_a0b33edabd7f1c4e4a0bf32c67269be2f}\label{main_8cpp_a0b33edabd7f1c4e4a0bf32c67269be2f}} 
\index{main.cpp@{main.cpp}!loop@{loop}}
\index{loop@{loop}!main.cpp@{main.cpp}}
\doxysubsubsection{\texorpdfstring{loop()}{loop()}}
{\footnotesize\ttfamily void loop (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{main_8cpp_source_l00117}{117}} of file \mbox{\hyperlink{main_8cpp_source}{main.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00118\ \{}
\DoxyCodeLine{00119\ \ \ \ \ \textcolor{comment}{//\ Process\ LVGL\ GUI\ events}}
\DoxyCodeLine{00120\ \ \ \ \ lv\_timer\_handler();}
\DoxyCodeLine{00121\ \ \ \ \ }
\DoxyCodeLine{00122\ \ \ \ \ \textcolor{comment}{//\ Run\ main\ application\ logic\ through\ App\ coordinator}}
\DoxyCodeLine{00123\ \ \ \ \ \mbox{\hyperlink{namespace_app_ae09dc71078b64c56c673b1ad1d25b5d1}{App::run}}();}
\DoxyCodeLine{00124\ \ \ \ \ }
\DoxyCodeLine{00125\ \ \ \ \ \textcolor{comment}{//\ Force\ periodic\ screen\ refresh\ for\ dynamic\ content\ (like\ WiFi\ scan\ lists)}}
\DoxyCodeLine{00126\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ lastRefresh\ =\ 0;}
\DoxyCodeLine{00127\ \ \ \ \ \textcolor{keywordflow}{if}\ (millis()\ -\/\ lastRefresh\ >\ 500)\ \{\ \textcolor{comment}{//\ Every\ 500ms}}
\DoxyCodeLine{00128\ \ \ \ \ \ \ \ \ lv\_refr\_now(lv\_disp\_get\_default());}
\DoxyCodeLine{00129\ \ \ \ \ \ \ \ \ lastRefresh\ =\ millis();}
\DoxyCodeLine{00130\ \ \ \ \ \}}
\DoxyCodeLine{00131\ \ \ \ \ }
\DoxyCodeLine{00132\ \ \ \ \ \textcolor{comment}{//\ Small\ delay\ for\ stability}}
\DoxyCodeLine{00133\ \ \ \ \ delay(5);}
\DoxyCodeLine{00134\ \}}

\end{DoxyCode}
\mbox{\Hypertarget{main_8cpp_a7dfd9b79bc5a37d7df40207afbc5431f}\label{main_8cpp_a7dfd9b79bc5a37d7df40207afbc5431f}} 
\index{main.cpp@{main.cpp}!setup@{setup}}
\index{setup@{setup}!main.cpp@{main.cpp}}
\doxysubsubsection{\texorpdfstring{setup()}{setup()}}
{\footnotesize\ttfamily void setup (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{main_8cpp_source_l00091}{91}} of file \mbox{\hyperlink{main_8cpp_source}{main.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00092\ \{}
\DoxyCodeLine{00093\ \ \ \ \ Serial.begin(115200);}
\DoxyCodeLine{00094\ \ \ \ \ Serial.println(\textcolor{stringliteral}{"{}===\ NWC\ Point\ of\ Sale\ Device\ Starting\ ==="{}});}
\DoxyCodeLine{00095\ \ \ \ \ Serial.println(\textcolor{stringliteral}{"{}Software\ Version:\ "{}}\ +\ SOFTWARE\_VERSION);}
\DoxyCodeLine{00096\ \ \ \ \ }
\DoxyCodeLine{00097\ \ \ \ \ \textcolor{comment}{//\ Initialize\ PSRAM\ memory\ space\ for\ Nostr\ operations\ to\ prevent\ heap\ fragmentation}}
\DoxyCodeLine{00098\ \ \ \ \ Serial.println(\textcolor{stringliteral}{"{}Initializing\ Nostr\ memory\ space..."{}});}
\DoxyCodeLine{00099\ \ \ \ \ \mbox{\hyperlink{namespacenostr_ad38d4b13131e9c51ec482ccfcbc32841}{nostr::initMemorySpace}}(\mbox{\hyperlink{main_8cpp_ab8338d33d592df45a77857c81340ed51}{EVENT\_NOTE\_SIZE}},\ \mbox{\hyperlink{main_8cpp_a8ea9ad716a8cc63afacef39f4534c56a}{ENCRYPTED\_MESSAGE\_BIN\_SIZE}});}
\DoxyCodeLine{00100\ \ \ \ \ Serial.println(\textcolor{stringliteral}{"{}Nostr\ memory\ space\ initialized"{}});}
\DoxyCodeLine{00101\ \ \ \ \ }
\DoxyCodeLine{00102\ \ \ \ \ \textcolor{comment}{//\ Initialize\ all\ application\ modules\ through\ the\ App\ coordinator}}
\DoxyCodeLine{00103\ \ \ \ \ \mbox{\hyperlink{namespace_app_a36c71ca6134247ab51d1a7a2d0a02cd4}{App::init}}();}
\DoxyCodeLine{00104\ \ \ \ \ }
\DoxyCodeLine{00105\ \ \ \ \ \textcolor{comment}{//\ Create\ status\ update\ timer\ (this\ will\ eventually\ move\ to\ a\ module)}}
\DoxyCodeLine{00106\ \ \ \ \ lv\_timer\_create(wifi\_main\_status\_updater\_cb,\ 1000,\ NULL);}
\DoxyCodeLine{00107\ \ \ \ \ }
\DoxyCodeLine{00108\ \ \ \ \ \textcolor{comment}{//\ Create\ queues\ for\ task\ communication\ (this\ will\ eventually\ move\ to\ respective\ modules)}}
\DoxyCodeLine{00109\ \ \ \ \ wifi\_command\_queue\ =\ xQueueCreate(10,\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structwifi__command__t}{wifi\_command\_t}}));}
\DoxyCodeLine{00110\ \ \ \ \ wifi\_scan\_result\_queue\ =\ xQueueCreate(5,\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structwifi__scan__result__t}{wifi\_scan\_result\_t}}));}
\DoxyCodeLine{00111\ \ \ \ \ invoice\_command\_queue\ =\ xQueueCreate(5,\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}));}
\DoxyCodeLine{00112\ \ \ \ \ invoice\_status\_queue\ =\ xQueueCreate(5,\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}));}
\DoxyCodeLine{00113\ \ \ \ \ }
\DoxyCodeLine{00114\ \ \ \ \ Serial.println(\textcolor{stringliteral}{"{}===\ Setup\ Complete\ ==="{}});}
\DoxyCodeLine{00115\ \}}

\end{DoxyCode}
