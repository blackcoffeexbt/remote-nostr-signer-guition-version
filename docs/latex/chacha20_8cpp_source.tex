\hypertarget{chacha20_8cpp_source}{}\doxysection{chacha20.\+cpp}
\label{chacha20_8cpp_source}\index{lib/nostr/nip44/chacha20.cpp@{lib/nostr/nip44/chacha20.cpp}}
\mbox{\hyperlink{chacha20_8cpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00001}00001\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{chacha20_8h}{chacha20.h}}"{}}}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00002}00002\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{helpers_8h}{helpers.h}}"{}}}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00003}00003\ }
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00004}\mbox{\hyperlink{chacha20_8cpp_a453d6c05303385256d9893904b125483}{00004}}\ \textcolor{preprocessor}{\#define\ ROTL32(v,\ n)\ (((v)\ <<\ (n))\ |\ ((v)\ >>\ (32\ -\/\ (n))))}}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00005}00005\ }
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00006}\mbox{\hyperlink{chacha20_8cpp_aae524f06f43cef9dde57fb1cecc75d4a}{00006}}\ \textcolor{preprocessor}{\#define\ QUARTERROUND(a,\ b,\ c,\ d)\ \(\backslash\)}}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00007}00007\ \textcolor{preprocessor}{\ \ \ \ a\ +=\ b;\ d\ \string^=\ a;\ d\ =\ ROTL32(d,\ 16);\ \(\backslash\)}}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00008}00008\ \textcolor{preprocessor}{\ \ \ \ c\ +=\ d;\ b\ \string^=\ c;\ b\ =\ ROTL32(b,\ 12);\ \(\backslash\)}}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00009}00009\ \textcolor{preprocessor}{\ \ \ \ a\ +=\ b;\ d\ \string^=\ a;\ d\ =\ ROTL32(d,\ 8);\ \(\backslash\)}}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00010}00010\ \textcolor{preprocessor}{\ \ \ \ c\ +=\ d;\ b\ \string^=\ c;\ b\ =\ ROTL32(b,\ 7);}}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00011}00011\ }
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00012}\mbox{\hyperlink{chacha20_8cpp_a268a65c9476c0ac2ea6c5262e13ce207}{00012}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{chacha20_8cpp_a268a65c9476c0ac2ea6c5262e13ce207}{chacha20\_init\_ctx}}(\textcolor{keyword}{struct}\ \mbox{\hyperlink{structchacha20__ctx}{chacha20\_ctx}}\ *ctx,\ \textcolor{keyword}{const}\ uint8\_t\ key[32],\ \textcolor{keyword}{const}\ uint8\_t\ nonce[12])\ \{}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00013}00013\ \ \ \ \ \textcolor{comment}{//\ Initialize\ context}}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00014}00014\ \ \ \ \ memset(ctx,\ 0,\ \textcolor{keyword}{sizeof}(*ctx));}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00015}00015\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00016}00016\ \ \ \ \ \textcolor{comment}{//\ Constants\ -\/\ "{}expand\ 32-\/byte\ k"{}}}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00017}00017\ \ \ \ \ ctx-\/>\mbox{\hyperlink{structchacha20__ctx_aa5a0a216c6ec152c1d45bb80963ad674}{state}}[0]\ =\ 0x61707865;}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00018}00018\ \ \ \ \ ctx-\/>\mbox{\hyperlink{structchacha20__ctx_aa5a0a216c6ec152c1d45bb80963ad674}{state}}[1]\ =\ 0x3320646e;}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00019}00019\ \ \ \ \ ctx-\/>\mbox{\hyperlink{structchacha20__ctx_aa5a0a216c6ec152c1d45bb80963ad674}{state}}[2]\ =\ 0x79622d32;}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00020}00020\ \ \ \ \ ctx-\/>\mbox{\hyperlink{structchacha20__ctx_aa5a0a216c6ec152c1d45bb80963ad674}{state}}[3]\ =\ 0x6b206574;}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00021}00021\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00022}00022\ \ \ \ \ \textcolor{comment}{//\ Key}}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00023}00023\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 8;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00024}00024\ \ \ \ \ \ \ \ \ ctx-\/>\mbox{\hyperlink{structchacha20__ctx_aa5a0a216c6ec152c1d45bb80963ad674}{state}}[4\ +\ i]\ =\ ((uint32\_t)key[4*i\ +\ 0]\ <<\ 0)\ |}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00025}00025\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ((uint32\_t)key[4*i\ +\ 1]\ <<\ 8)\ |}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00026}00026\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ((uint32\_t)key[4*i\ +\ 2]\ <<\ 16)\ |}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00027}00027\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ((uint32\_t)key[4*i\ +\ 3]\ <<\ 24);}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00028}00028\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00029}00029\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00030}00030\ \ \ \ \ \textcolor{comment}{//\ Counter\ (starts\ at\ 0)}}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00031}00031\ \ \ \ \ ctx-\/>\mbox{\hyperlink{structchacha20__ctx_aa5a0a216c6ec152c1d45bb80963ad674}{state}}[12]\ =\ 0;}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00032}00032\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00033}00033\ \ \ \ \ \textcolor{comment}{//\ Nonce}}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00034}00034\ \ \ \ \ ctx-\/>\mbox{\hyperlink{structchacha20__ctx_aa5a0a216c6ec152c1d45bb80963ad674}{state}}[13]\ =\ ((uint32\_t)nonce[0]\ <<\ 0)\ |}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00035}00035\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ((uint32\_t)nonce[1]\ <<\ 8)\ |}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00036}00036\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ((uint32\_t)nonce[2]\ <<\ 16)\ |}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00037}00037\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ((uint32\_t)nonce[3]\ <<\ 24);}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00038}00038\ \ \ \ \ ctx-\/>\mbox{\hyperlink{structchacha20__ctx_aa5a0a216c6ec152c1d45bb80963ad674}{state}}[14]\ =\ ((uint32\_t)nonce[4]\ <<\ 0)\ |}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00039}00039\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ((uint32\_t)nonce[5]\ <<\ 8)\ |}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00040}00040\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ((uint32\_t)nonce[6]\ <<\ 16)\ |}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00041}00041\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ((uint32\_t)nonce[7]\ <<\ 24);}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00042}00042\ \ \ \ \ ctx-\/>\mbox{\hyperlink{structchacha20__ctx_aa5a0a216c6ec152c1d45bb80963ad674}{state}}[15]\ =\ ((uint32\_t)nonce[8]\ <<\ 0)\ |}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00043}00043\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ((uint32\_t)nonce[9]\ <<\ 8)\ |}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00044}00044\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ((uint32\_t)nonce[10]\ <<\ 16)\ |}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00045}00045\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ((uint32\_t)nonce[11]\ <<\ 24);}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00046}00046\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00047}00047\ \ \ \ \ ctx-\/>\mbox{\hyperlink{structchacha20__ctx_a6f4041cbba8b07077459aace885d30a4}{buffer\_used}}\ =\ 64;\ \textcolor{comment}{//\ Force\ new\ block\ generation\ on\ first\ use}}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00048}00048\ \}}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00049}00049\ }
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00050}\mbox{\hyperlink{chacha20_8cpp_a1bd1114af5778b45f328ac106c96d84a}{00050}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{chacha20_8cpp_a1bd1114af5778b45f328ac106c96d84a}{chacha20\_block}}(\textcolor{keyword}{struct}\ \mbox{\hyperlink{structchacha20__ctx}{chacha20\_ctx}}\ *ctx)\ \{}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00051}00051\ \ \ \ \ uint32\_t\ x[16];}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00052}00052\ \ \ \ \ memcpy(x,\ ctx-\/>\mbox{\hyperlink{structchacha20__ctx_aa5a0a216c6ec152c1d45bb80963ad674}{state}},\ \textcolor{keyword}{sizeof}(x));}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00053}00053\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00054}00054\ \ \ \ \ \textcolor{comment}{//\ Perform\ ChaCha20\ rounds}}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00055}00055\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 10;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00056}00056\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Column\ rounds}}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00057}00057\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chacha20_8cpp_aae524f06f43cef9dde57fb1cecc75d4a}{QUARTERROUND}}(x[0],\ x[4],\ x[8],\ x[12])}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00058}00058\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chacha20_8cpp_aae524f06f43cef9dde57fb1cecc75d4a}{QUARTERROUND}}(x[1],\ x[5],\ x[9],\ x[13])}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00059}00059\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chacha20_8cpp_aae524f06f43cef9dde57fb1cecc75d4a}{QUARTERROUND}}(x[2],\ x[6],\ x[10],\ x[14])}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00060}00060\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chacha20_8cpp_aae524f06f43cef9dde57fb1cecc75d4a}{QUARTERROUND}}(x[3],\ x[7],\ x[11],\ x[15])}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00061}00061\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Diagonal\ rounds}}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00062}00062\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chacha20_8cpp_aae524f06f43cef9dde57fb1cecc75d4a}{QUARTERROUND}}(x[0],\ x[5],\ x[10],\ x[15])}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00063}00063\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chacha20_8cpp_aae524f06f43cef9dde57fb1cecc75d4a}{QUARTERROUND}}(x[1],\ x[6],\ x[11],\ x[12])}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00064}00064\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chacha20_8cpp_aae524f06f43cef9dde57fb1cecc75d4a}{QUARTERROUND}}(x[2],\ x[7],\ x[8],\ x[13])}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00065}00065\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chacha20_8cpp_aae524f06f43cef9dde57fb1cecc75d4a}{QUARTERROUND}}(x[3],\ x[4],\ x[9],\ x[14])}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00066}00066\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00067}00067\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00068}00068\ \ \ \ \ \textcolor{comment}{//\ Add\ input\ state\ to\ the\ result}}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00069}00069\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 16;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00070}00070\ \ \ \ \ \ \ \ \ uint32\_t\ v\ =\ x[i]\ +\ ctx-\/>\mbox{\hyperlink{structchacha20__ctx_aa5a0a216c6ec152c1d45bb80963ad674}{state}}[i];}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00071}00071\ \ \ \ \ \ \ \ \ ctx-\/>\mbox{\hyperlink{structchacha20__ctx_a4f044e2de49c909885be4b11120d0682}{buffer}}[4*i\ +\ 0]\ =\ v\ \&\ 0xff;}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00072}00072\ \ \ \ \ \ \ \ \ ctx-\/>\mbox{\hyperlink{structchacha20__ctx_a4f044e2de49c909885be4b11120d0682}{buffer}}[4*i\ +\ 1]\ =\ (v\ >>\ 8)\ \&\ 0xff;}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00073}00073\ \ \ \ \ \ \ \ \ ctx-\/>\mbox{\hyperlink{structchacha20__ctx_a4f044e2de49c909885be4b11120d0682}{buffer}}[4*i\ +\ 2]\ =\ (v\ >>\ 16)\ \&\ 0xff;}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00074}00074\ \ \ \ \ \ \ \ \ ctx-\/>\mbox{\hyperlink{structchacha20__ctx_a4f044e2de49c909885be4b11120d0682}{buffer}}[4*i\ +\ 3]\ =\ (v\ >>\ 24)\ \&\ 0xff;}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00075}00075\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00076}00076\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00077}00077\ \ \ \ \ \textcolor{comment}{//\ Reset\ buffer\ usage}}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00078}00078\ \ \ \ \ ctx-\/>\mbox{\hyperlink{structchacha20__ctx_a6f4041cbba8b07077459aace885d30a4}{buffer\_used}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00079}00079\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00080}00080\ \ \ \ \ \textcolor{comment}{//\ Increment\ counter\ with\ overflow\ check}}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00081}00081\ \ \ \ \ ctx-\/>\mbox{\hyperlink{structchacha20__ctx_aa5a0a216c6ec152c1d45bb80963ad674}{state}}[12]++;}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00082}00082\ \ \ \ \ \textcolor{keywordflow}{if}\ (ctx-\/>\mbox{\hyperlink{structchacha20__ctx_aa5a0a216c6ec152c1d45bb80963ad674}{state}}[12]\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00083}00083\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Counter\ wrapped,\ increment\ next\ word}}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00084}00084\ \ \ \ \ \ \ \ \ ctx-\/>\mbox{\hyperlink{structchacha20__ctx_aa5a0a216c6ec152c1d45bb80963ad674}{state}}[13]++;}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00085}00085\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00086}00086\ \}}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00087}00087\ }
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00088}\mbox{\hyperlink{chacha20_8cpp_ae2b236dc071d0ce2940ce0593d03b09f}{00088}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{chacha20_8cpp_ae2b236dc071d0ce2940ce0593d03b09f}{chacha20\_encrypt}}(\textcolor{keyword}{struct}\ \mbox{\hyperlink{structchacha20__ctx}{chacha20\_ctx}}\ *ctx,\ uint8\_t\ *output,\ \textcolor{keyword}{const}\ uint8\_t\ *input,\ \textcolor{keywordtype}{size\_t}\ length)\ \{}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00089}00089\ \ \ \ \ \textcolor{keywordflow}{if}\ (!output\ ||\ !input\ ||\ length\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00090}00090\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{helpers_8cpp_a5bef8eb35193fa4586662db6d111ded7}{logInfo}}(\textcolor{stringliteral}{"{}ChaCha20:\ Invalid\ parameters"{}});}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00091}00091\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00092}00092\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00093}00093\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00094}00094\ \ \ \ \ \mbox{\hyperlink{helpers_8cpp_a5bef8eb35193fa4586662db6d111ded7}{logInfo}}(\textcolor{stringliteral}{"{}ChaCha20\ processing\ length:\ "{}}\ +\ String(length));}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00095}00095\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ total\_processed\ =\ 0;}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00096}00096\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00097}00097\ \ \ \ \ \textcolor{comment}{//\ Log\ first\ few\ bytes\ of\ input}}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00098}00098\ \ \ \ \ String\ inputHex;}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00099}00099\ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ std::min(length,\ (\textcolor{keywordtype}{size\_t})16);\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00100}00100\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ hex[3];}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00101}00101\ \ \ \ \ \ \ \ \ snprintf(hex,\ \textcolor{keyword}{sizeof}(hex),\ \textcolor{stringliteral}{"{}\%02x"{}},\ input[i]);}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00102}00102\ \ \ \ \ \ \ \ \ inputHex\ +=\ hex;}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00103}00103\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00104}00104\ \ \ \ \ \mbox{\hyperlink{helpers_8cpp_a5bef8eb35193fa4586662db6d111ded7}{logInfo}}(\textcolor{stringliteral}{"{}First\ bytes\ of\ input:\ "{}}\ +\ inputHex);}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00105}00105\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00106}00106\ \ \ \ \ \textcolor{keywordflow}{while}\ (length\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00107}00107\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Generate\ new\ block\ if\ needed}}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00108}00108\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (ctx-\/>\mbox{\hyperlink{structchacha20__ctx_a6f4041cbba8b07077459aace885d30a4}{buffer\_used}}\ >=\ 64)\ \{}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00109}00109\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{helpers_8cpp_a5bef8eb35193fa4586662db6d111ded7}{logInfo}}(\textcolor{stringliteral}{"{}Generating\ new\ block\ at\ offset:\ "{}}\ +\ String(total\_processed));}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00110}00110\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chacha20_8cpp_a1bd1114af5778b45f328ac106c96d84a}{chacha20\_block}}(ctx);}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00111}00111\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00112}00112\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00113}00113\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Calculate\ how\ many\ bytes\ we\ can\ process\ from\ current\ block}}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00114}00114\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ available\ =\ 64\ -\/\ ctx-\/>\mbox{\hyperlink{structchacha20__ctx_a6f4041cbba8b07077459aace885d30a4}{buffer\_used}};}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00115}00115\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ use\ =\ length\ >\ available\ ?\ available\ :\ length;}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00116}00116\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00117}00117\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{helpers_8cpp_a5bef8eb35193fa4586662db6d111ded7}{logInfo}}(\textcolor{stringliteral}{"{}Processing\ block\ of\ size:\ "{}}\ +\ String(use)\ +\ }
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00118}00118\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ at\ offset:\ "{}}\ +\ String(total\_processed)\ +\ }
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00119}00119\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ buffer\_used:\ "{}}\ +\ String(ctx-\/>\mbox{\hyperlink{structchacha20__ctx_a6f4041cbba8b07077459aace885d30a4}{buffer\_used}})\ +}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00120}00120\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ remaining:\ "{}}\ +\ String(length));}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00121}00121\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00122}00122\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ XOR\ the\ input\ with\ the\ keystream}}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00123}00123\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ use;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00124}00124\ \ \ \ \ \ \ \ \ \ \ \ \ output[total\_processed\ +\ i]\ =\ input[total\_processed\ +\ i]\ \string^\ }
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00125}00125\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ctx-\/>\mbox{\hyperlink{structchacha20__ctx_a4f044e2de49c909885be4b11120d0682}{buffer}}[ctx-\/>\mbox{\hyperlink{structchacha20__ctx_a6f4041cbba8b07077459aace885d30a4}{buffer\_used}}\ +\ i];}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00126}00126\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00127}00127\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00128}00128\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Log\ a\ few\ bytes\ of\ output\ after\ each\ block}}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00129}00129\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (total\_processed\ <\ 16)\ \{}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00130}00130\ \ \ \ \ \ \ \ \ \ \ \ \ String\ outputHex;}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00131}00131\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t}\ i\ =\ total\_processed;\ i\ <\ std::min(total\_processed\ +\ use,\ (\textcolor{keywordtype}{size\_t})16);\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00132}00132\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ hex[3];}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00133}00133\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ snprintf(hex,\ \textcolor{keyword}{sizeof}(hex),\ \textcolor{stringliteral}{"{}\%02x"{}},\ output[i]);}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00134}00134\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ outputHex\ +=\ hex;}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00135}00135\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00136}00136\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{helpers_8cpp_a5bef8eb35193fa4586662db6d111ded7}{logInfo}}(\textcolor{stringliteral}{"{}Output\ bytes\ at\ "{}}\ +\ String(total\_processed)\ +\ \textcolor{stringliteral}{"{}:\ "{}}\ +\ outputHex);}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00137}00137\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00138}00138\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00139}00139\ \ \ \ \ \ \ \ \ ctx-\/>\mbox{\hyperlink{structchacha20__ctx_a6f4041cbba8b07077459aace885d30a4}{buffer\_used}}\ +=\ use;}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00140}00140\ \ \ \ \ \ \ \ \ length\ -\/=\ use;}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00141}00141\ \ \ \ \ \ \ \ \ total\_processed\ +=\ use;}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00142}00142\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00143}00143\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00144}00144\ \ \ \ \ \mbox{\hyperlink{helpers_8cpp_a5bef8eb35193fa4586662db6d111ded7}{logInfo}}(\textcolor{stringliteral}{"{}ChaCha20\ completed,\ total\ processed:\ "{}}\ +\ String(total\_processed));}
\DoxyCodeLine{\Hypertarget{chacha20_8cpp_source_l00145}00145\ \}\ }

\end{DoxyCode}
